(function(){"use strict";var e={4565:function(e,t,a){var s=a(5130),n=a(657),o=a(6768);const i={class:"game-layout",style:{border:"2px solid lightblue",position:"relative"}},r={class:"game-layout__content"};var c=(0,o.pM)({__name:"GameLayout",setup(e){return(e,t)=>((0,o.uX)(),(0,o.CE)("div",i,[t[0]||(t[0]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"GameLayout",-1)),(0,o.Lk)("main",r,[(0,o.RG)(e.$slots,"default")]),t[1]||(t[1]=(0,o.Lk)("footer",{class:"game-layout__footer"},[(0,o.Lk)("p",null,"© 2025 Pathfinder's Journey")],-1))]))}}),l=a(1241);const d=(0,l.A)(c,[["__scopeId","data-v-656b48d5"]]);var u=d,h=(0,o.pM)({__name:"App",setup(e){return(e,t)=>{const a=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.Wv)(u,null,{default:(0,o.k6)((()=>[(0,o.bF)(a)])),_:1})}}});const m=h;var p,g=m,f=a(1387),y=(a(4114),a(4232)),v=a(144);a(8111),a(2489),a(116),a(7588),a(1701),a(3579);(function(e){e["LOYAL"]="LOYAL",e["WARY"]="WARY",e["LEAVING"]="LEAVING"})(p||(p={}));var C,L,E;a(8237);(function(e){e["CHARACTER"]="CHARACTER",e["LANDSCAPE"]="LANDSCAPE",e["ANIMAL_COMPANION"]="ANIMAL_COMPANION",e["RESOURCE"]="RESOURCE",e["CRAFTED_ITEM"]="CRAFTED_ITEM",e["SEASON"]="SEASON"})(C||(C={})),function(e){e["STRENGTH"]="STRENGTH",e["WISDOM"]="WISDOM",e["AGILITY"]="AGILITY",e["DIPLOMACY"]="DIPLOMACY",e["SURVIVAL"]="SURVIVAL"}(L||(L={})),function(e){e["SAMHAIN"]="samhain",e["WINTERS_DEPTH"]="wintersDepth",e["IMBOLC"]="imbolc",e["BELTANE"]="beltane",e["LUGHNASADH"]="lughnasadh"}(E||(E={}));const T=(0,n.nY)("card",{state:()=>({characters:[],landscapes:[],animalCompanions:[],resources:[],craftedItems:[],seasons:[],initialized:!1}),getters:{getCharacterById:e=>t=>e.characters.find((e=>e.id===t)),getLandscapeById:e=>t=>e.landscapes.find((e=>e.id===t)),getAnimalCompanionById:e=>t=>e.animalCompanions.find((e=>e.id===t)),getCompanionById:e=>t=>e.animalCompanions.find((e=>e.id===t)),getResourceById:e=>t=>e.resources.find((e=>e.id===t)),getCraftedItemById:e=>t=>e.craftedItems.find((e=>e.id===t)),getSeasonById:e=>t=>e.seasons.find((e=>e.id===t)),getChallengeById:e=>t=>{const a=e.landscapes.reduce(((e,t)=>{if(t.challenges){const a=t.challenges.map((e=>({id:`${t.id}_${e.type.toLowerCase()}`,name:`${t.name} ${e.type}`,description:`A ${e.type} challenge at ${t.name}`,type:e.type,difficulty:e.difficulty,rewards:{resources:[],experience:10,knowledge:t.id}})));return[...e,...a]}return e}),[]);return a.find((e=>e.id===t))},getResourcesBySeason:e=>t=>e.resources.filter((e=>e.seasonalAbundance.includes(t))),getCompanionsBySeason:e=>t=>e.animalCompanions.filter((e=>e.affinitySeasons.includes(t))),getAllCraftedItems:e=>()=>e.craftedItems,getCraftableItems:e=>()=>e.craftedItems.map((e=>e.id))},actions:{initializeCards(){this.initializeCharacters(),this.initializeLandscapes(),this.initializeAnimalCompanions(),this.initializeResources(),this.initializeCraftedItems(),this.initializeSeasons(),this.initialized=!0},initializeCharacters(){this.characters=[{id:"character_1",name:"The Druid",description:"A keeper of ancient wisdom with a deep connection to nature.",type:C.CHARACTER,healthPoints:8,strength:6,wisdom:10,agility:6,diplomacy:8,survival:9,resourceCapacity:6,image:"/images/characters/druid.jpg",specialAbility:{name:"Nature's Harmony",description:"Can communicate with animals to gain insights about the landscape."},startingResources:["resource_1","resource_5"],startingCompanion:"companion_1"},{id:"character_2",name:"The Warrior",description:"A brave fighter skilled in combat and survival.",type:C.CHARACTER,healthPoints:12,strength:10,wisdom:6,agility:8,diplomacy:5,survival:8,resourceCapacity:4,image:"/images/characters/warrior.jpg",specialAbility:{name:"Battle Prowess",description:"Years of training have honed combat skills to perfection."},startingResources:["resource_2","resource_3"]},{id:"character_3",name:"The Bard",description:"A storyteller who carries the history and legends of the Celtic people.",type:C.CHARACTER,healthPoints:6,strength:5,wisdom:9,agility:7,diplomacy:10,survival:7,resourceCapacity:8,image:"/images/characters/bard.jpg",specialAbility:{name:"Ancient Tales",description:"Knowledge of old stories reveals secrets of the land."},startingResources:["resource_4","resource_7","resource_9"]},{id:"giant_beastfriend",name:"Giant Beastfriend",description:"A towering figure with a natural affinity for wild creatures, able to form bonds with even the most ferocious beasts.",type:C.CHARACTER,healthPoints:7,strength:8,wisdom:7,agility:5,diplomacy:4,survival:9,resourceCapacity:8,image:"/images/characters/giant_beastfriend.jpg",specialAbility:{name:"Animal Empathy",description:"Animal Companions cost -1 resource to bond with"},startingResources:["resource_3","resource_6"],challengeBonuses:{physical:3,mental:2,spiritual:3,social:1}},{id:"hedge_witch",name:"Hedge Witch/Warlock",description:"A practitioner of herbal magic and minor enchantments who dwells at the borderlands between civilization and wilderness.",type:C.CHARACTER,healthPoints:5,strength:4,wisdom:10,agility:6,diplomacy:5,survival:8,resourceCapacity:7,image:"/images/characters/hedge_witch.jpg",specialAbility:{name:"Herbal Knowledge",description:"Can substitute one resource for another when crafting"},startingResources:["resource_8","resource_10"],challengeBonuses:{physical:1,mental:3,spiritual:4,social:1}},{id:"iron_crafter",name:"Iron Crafter",description:"A master smith whose knowledge of metals and fire allows them to create items of remarkable power.",type:C.CHARACTER,healthPoints:6,strength:7,wisdom:8,agility:5,diplomacy:6,survival:6,resourceCapacity:6,image:"/images/characters/iron_crafter.jpg",specialAbility:{name:"Master Smith",description:"Crafting requires one fewer resource"},startingResources:["resource_2","resource_5"],challengeBonuses:{physical:3,mental:3,spiritual:1,social:2}},{id:"village_elder",name:"Village Elder",description:"A respected keeper of tradition and wisdom, whose connection to the community provides unique advantages.",type:C.CHARACTER,healthPoints:5,strength:3,wisdom:12,agility:4,diplomacy:9,survival:7,resourceCapacity:5,image:"/images/characters/village_elder.jpg",specialAbility:{name:"Ancient Wisdom",description:"Start with knowledge of entire journey path (all landscapes revealed at beginning)"},startingResources:["resource_7","resource_9"],challengeBonuses:{physical:1,mental:4,spiritual:3,social:3}}]},initializeLandscapes(){this.landscapes=[{id:"landscape_1",name:"The Misty Forest",description:"An ancient woodland shrouded in mist where spirits are said to dwell.",type:C.LANDSCAPE,challenges:[{id:"challenge_1",name:"Lost Path",description:"The mist has obscured the path, making navigation difficult.",type:L.WISDOM,difficulty:2,rewards:{resources:["resource_1","resource_5"],experience:1}},{id:"challenge_2",name:"Forest Guardian",description:"A mysterious entity blocks your path, demanding a tribute.",type:L.DIPLOMACY,difficulty:3,rewards:{resources:["resource_7"],experience:2,knowledge:"The forest spirits value respect above all else."}}],availableResources:["resource_1","resource_5","resource_8"],specialFeature:{name:"Ancient Grove",description:"A sacred place where druids once gathered.",effect:"Heal 1 health if you spend a turn meditating here."}},{id:"landscape_2",name:"The Standing Stones",description:"A circle of megalithic stones humming with ancient power.",type:C.LANDSCAPE,challenges:[{id:"challenge_3",name:"Ritual Alignment",description:"The stones must be aligned with the stars to unlock their power.",type:L.WISDOM,difficulty:4,rewards:{resources:["resource_10"],experience:2,knowledge:"The stones align with the seasonal transitions."}}],availableResources:["resource_2","resource_10"],specialFeature:{name:"Ley Line Nexus",description:"A powerful convergence of earth energies.",effect:"Your special ability can be used twice in this location."}}]},initializeAnimalCompanions(){this.animalCompanions=[{id:"companion_1",name:"Raven",description:"A wise bird associated with prophecy and insight.",type:C.ANIMAL_COMPANION,ability:{name:"Far Sight",description:"The raven scouts ahead, revealing dangers and opportunities.",effect:"Preview the next landscape before traveling there."},affinitySeasons:[E.SAMHAIN,E.WINTERS_DEPTH]},{id:"companion_2",name:"Wolf",description:"A loyal pack animal with keen senses.",type:C.ANIMAL_COMPANION,ability:{name:"Pack Hunter",description:"The wolf helps track and hunt for resources.",effect:"Gain an extra resource when gathering in a landscape."},affinitySeasons:[E.WINTERS_DEPTH,E.IMBOLC]},{id:"companion_3",name:"Stag",description:"A majestic forest dweller representing renewal and abundance.",type:C.ANIMAL_COMPANION,ability:{name:"Forest Guide",description:"The stag knows hidden paths through the wilderness.",effect:"Reduce the difficulty of navigation challenges by 1."},affinitySeasons:[E.BELTANE,E.LUGHNASADH]}]},initializeResources(){this.resources=[{id:"resource_1",name:"Healing Herbs",description:"Plants with medicinal properties that can restore health.",type:C.RESOURCE,rarity:"common",seasonalAbundance:[E.BELTANE,E.LUGHNASADH],specialEffect:{name:"Herbal Remedy",description:"A poultice made from these herbs can heal wounds.",effect:"Restore 1 health when used."}},{id:"resource_2",name:"Sacred Oak Wood",description:"Wood from the revered oak tree, imbued with strength.",type:C.RESOURCE,rarity:"uncommon",seasonalAbundance:[E.LUGHNASADH]},{id:"resource_3",name:"Iron Ore",description:"Raw metal used for crafting tools and weapons.",type:C.RESOURCE,rarity:"uncommon",seasonalAbundance:[E.IMBOLC,E.BELTANE]},{id:"resource_4",name:"Mistletoe",description:"A parasitic plant considered sacred by the druids.",type:C.RESOURCE,rarity:"rare",seasonalAbundance:[E.WINTERS_DEPTH],specialEffect:{name:"Druidic Focus",description:"Enhances spiritual connection when used in rituals.",effect:"Add +1 to wisdom challenges when used."}},{id:"resource_5",name:"Wild Berries",description:"Nutritious forest fruits that provide sustenance.",type:C.RESOURCE,rarity:"common",seasonalAbundance:[E.BELTANE,E.LUGHNASADH]}]},initializeCraftedItems(){this.craftedItems=[{id:"item_1",name:"Herbal Poultice",description:"A medicinal wrap made from healing herbs.",type:C.CRAFTED_ITEM,requiredResources:["resource_1","resource_5"],complexity:1,ability:{name:"Healing Touch",description:"Applies healing herbs directly to wounds.",effect:"Restore 2 health when used."}},{id:"item_2",name:"Oak Staff",description:"A sturdy staff carved from sacred oak wood.",type:C.CRAFTED_ITEM,requiredResources:["resource_2"],complexity:2,ability:{name:"Nature's Authority",description:"The staff channels the power of the oak.",effect:"Add +1 to all wisdom challenges."},drawback:{description:"The staff is heavy and cumbersome.",effect:"Reduce resource capacity by 1 while carried."}},{id:"item_3",name:"Iron Blade",description:"A simple but effective weapon forged from iron.",type:C.CRAFTED_ITEM,requiredResources:["resource_3"],complexity:3,ability:{name:"Sharp Edge",description:"The blade cuts through obstacles with ease.",effect:"Add +2 to strength challenges."}}]},initializeSeasons(){this.seasons=[{id:"season_1",name:"Samhain",description:"The Celtic new year, when the veil between worlds is thinnest.",type:C.SEASON,season:E.SAMHAIN,abundantResources:["resource_4"],scarceResources:["resource_1","resource_5"],animalAffinities:["companion_1"],effects:[{name:"Thin Veil",description:"The boundary between the mortal world and the Otherworld weakens.",effect:"Wisdom challenges are easier, but unexpected spirits may appear."}]},{id:"season_2",name:"Winter's Depth",description:"The coldest time of year, when survival is most challenging.",type:C.SEASON,season:E.WINTERS_DEPTH,abundantResources:[],scarceResources:["resource_1","resource_2","resource_5"],animalAffinities:["companion_1","companion_2"],effects:[{name:"Bitter Cold",description:"The harsh weather tests endurance and resourcefulness.",effect:"Lose 1 health at the end of each turn unless sheltered."}]},{id:"season_3",name:"Imbolc",description:"The first stirrings of spring, a time of purification and renewal.",type:C.SEASON,season:E.IMBOLC,abundantResources:["resource_3"],scarceResources:[],animalAffinities:["companion_2"],effects:[{name:"Renewal",description:"The land begins to awaken from winter's slumber.",effect:"Heal 1 health at the start of each turn."}]},{id:"season_4",name:"Beltane",description:"The height of spring, celebrating fertility and growth.",type:C.SEASON,season:E.BELTANE,abundantResources:["resource_1","resource_3","resource_5"],scarceResources:["resource_4"],animalAffinities:["companion_3"],effects:[{name:"Abundant Growth",description:"The land is lush with new life and energy.",effect:"Gather one additional resource per turn."}]},{id:"season_5",name:"Lughnasadh",description:"The harvest festival, celebrating the first fruits of the season.",type:C.SEASON,season:E.LUGHNASADH,abundantResources:["resource_1","resource_2","resource_5"],scarceResources:[],animalAffinities:["companion_3"],effects:[{name:"Harvest Bounty",description:"The land provides abundant resources before winter.",effect:"Resource capacity is increased by 2 during this season."}]}]}}});var S;a(1148);(function(e){e["SETUP"]="SETUP",e["CHARACTER_SELECTION"]="CHARACTER_SELECTION",e["SEASONAL_ASSESSMENT"]="SEASONAL_ASSESSMENT",e["THREAT_LEVEL_CHECK"]="THREAT_LEVEL_CHECK",e["LANDSCAPE_CHALLENGE"]="LANDSCAPE_CHALLENGE",e["CHALLENGE_RESOLUTION"]="CHALLENGE_RESOLUTION",e["RESOURCE_MANAGEMENT"]="RESOURCE_MANAGEMENT",e["ANIMAL_COMPANION"]="ANIMAL_COMPANION",e["CRAFTING"]="CRAFTING",e["JOURNEY_PROGRESSION"]="JOURNEY_PROGRESSION",e["HEALING_RECOVERY"]="HEALING_RECOVERY",e["GAME_OVER"]="GAME_OVER"})(S||(S={}));const b=(0,n.nY)("game",{state:()=>({currentPhase:S.CHARACTER_SELECTION,currentTurn:1,currentSeason:E.SAMHAIN,currentLandscapeId:"",currentChallenge:null,visitedLandscapes:[],journeyProgress:0,journeyPath:[],gameLog:[],victoryConditions:{journeyCompleted:!1,balanceMaintained:!1,knowledgeAcquired:!1,bondsFormed:!1,questFulfilled:!1,landscapesTraversed:!1,seasonsExperienced:!1,challengesOvercome:!1},gameStarted:!1,gameOver:!1,isVictory:!1,threatTokens:0,blessingTokens:0,challengeHistory:[],tempEffects:[],journeyComplete:!1,wisdom:0,ceremonyCompleted:!1}),getters:{currentLandscape(){const e=T(),t=e.getLandscapeById(this.currentLandscapeId);return t||null},currentSeasonCard(){const e=T(),t=e.getSeasonById(this.currentSeason);return t||null},journeyPercentage(){return Math.min(100,Math.round(this.journeyProgress/10*100))},isGameOver(){return this.gameOver},hasWon(){return this.isVictory},formattedGameLog(){return[...this.gameLog].reverse()},threatLevel(){return Math.floor(this.threatTokens/3)},hasTempEffect(){return e=>this.tempEffects.some((t=>t.id===e&&t.duration>0))},getTempEffectStrength(){return e=>{const t=this.tempEffects.find((t=>t.id===e&&t.duration>0));return t?t.strength:0}}},actions:{startGame(){this.gameStarted=!0,this.currentPhase=S.CHARACTER_SELECTION,this.currentTurn=1,this.currentSeason=E.SAMHAIN,this.threatTokens=0,this.tempEffects=[],this.addToGameLog("Your journey begins in the season of Samhain, when the veil between worlds is thinnest.",!0)},resetGame(){this.currentPhase=S.CHARACTER_SELECTION,this.currentTurn=1,this.currentSeason=E.SAMHAIN,this.currentLandscapeId="",this.currentChallenge=null,this.visitedLandscapes=[],this.journeyProgress=0,this.journeyPath=[],this.gameLog=[],this.victoryConditions={journeyCompleted:!1,balanceMaintained:!1,knowledgeAcquired:!1,bondsFormed:!1,questFulfilled:!1,landscapesTraversed:!1,seasonsExperienced:!1,challengesOvercome:!1},this.gameStarted=!1,this.gameOver=!1,this.isVictory=!1,this.threatTokens=0,this.blessingTokens=0,this.challengeHistory=[],this.tempEffects=[]},endGame(e){this.gameOver=!0,this.isVictory=e,e?this.addToGameLog("Congratulations! You have completed your journey through the Celtic Realm.",!0):this.addToGameLog("Your journey has come to an end. The Celtic Realm remains shrouded in mystery.",!0),this.currentPhase=S.GAME_OVER},setPhase(e){this.currentPhase=e,this.addToGameLog(`Entering the ${this.formatPhase(e)} phase.`)},advancePhase(){const e=[S.CHARACTER_SELECTION,S.SEASONAL_ASSESSMENT,S.THREAT_LEVEL_CHECK,S.LANDSCAPE_CHALLENGE,S.CHALLENGE_RESOLUTION,S.RESOURCE_MANAGEMENT,S.ANIMAL_COMPANION,S.CRAFTING,S.HEALING_RECOVERY,S.JOURNEY_PROGRESSION],t=e.indexOf(this.currentPhase);-1!==t&&(this.currentPhase=e[(t+1)%e.length],this.addToGameLog(`Entering the ${this.formatPhase(this.currentPhase)} phase.`,!0,"phase",{previousPhase:e[t],newPhase:this.currentPhase}),this.currentPhase===S.SEASONAL_ASSESSMENT&&this.advanceTurn())},advanceTurn(){this.currentTurn++,this.addToGameLog(`Turn ${this.currentTurn} has begun.`,!0,"system",{newTurn:this.currentTurn,currentSeason:this.formatSeason(this.currentSeason)}),this.processTempEffects(),this.currentTurn%3===0&&this.advanceSeason(),this.checkVictoryConditions()},advanceSeason(){const e=[E.SAMHAIN,E.WINTERS_DEPTH,E.IMBOLC,E.BELTANE,E.LUGHNASADH],t=e.indexOf(this.currentSeason);if(-1!==t){const a=(t+1)%e.length,s=this.currentSeason;this.currentSeason=e[a],this.addToGameLog(`The season has changed to ${this.formatSeason(this.currentSeason)}.`,!0,"phase",{previousSeason:this.formatSeason(s),newSeason:this.formatSeason(this.currentSeason),turn:this.currentTurn}),this.processSeasonalResourceChanges(s,this.currentSeason);const n=T(),o=n.getSeasonById(this.currentSeason);o&&(this.addToGameLog(`${o.name}: ${o.description}`,!1,"system",{seasonEffects:o.effects}),o.effects&&o.effects.length>0&&o.effects.forEach((e=>{const t="string"===typeof e.effect?e.effect:`${e.effect}`;this.addToGameLog(`Season Effect: ${e.name} - ${t}`,!1,"system",{effectDetails:e})})))}},setCurrentLandscape(e){const t=this.currentLandscapeId;this.currentLandscapeId=e,this.visitedLandscapes.includes(e)||this.addVisitedLandscape(e);const a=T(),s=a.getLandscapeById(e);s&&(this.addToGameLog(`You have arrived at ${s.name}.`,!0,"action",{previousLandscapeId:t,newLandscapeId:e,landscapeName:s.name,availableResources:s.availableResources,specialFeature:s.specialFeature,providesShelter:s.providesShelter}),s.entryEffect&&this.addToGameLog(`${s.name} Entry Effect: ${s.entryEffect.description}`,!1,"system",{entryEffect:s.entryEffect}),this.visitedLandscapes.length>=10&&(this.victoryConditions.landscapesTraversed=!0,this.addToGameLog("You have traversed enough landscapes to complete your journey.",!0,"system",{visitedLandscapes:this.visitedLandscapes.length,requiredLandscapes:10})))},addVisitedLandscape(e){if(!this.visitedLandscapes.includes(e)){this.visitedLandscapes.push(e);const t=T(),a=t.getLandscapeById(e);a&&(this.addToGameLog(`${a.name} has been added to your journey path.`,!1,"system",{landscapeId:e,landscapeName:a.name,visitedLandscapesCount:this.visitedLandscapes.length}),this.journeyPath.push(e),this.advanceJourney(1))}},setCurrentChallenge(e){const t=this.currentChallenge;if(this.currentChallenge=e,e){const a=T(),s=a.getChallengeById(e);if(s){const a=s.name||`${this.currentLandscape?.name||"Unknown"} Challenge`,n=s.type||"unknown",o=s.difficulty||5,i=s.rewards||{resources:[],experience:0};this.addToGameLog(`You face a challenge: ${a}`,!0,"challenge",{previousChallengeId:t,newChallengeId:e,challengeName:a,challengeType:n,challengeDifficulty:o,challengeRewards:i})}}else this.addToGameLog("The challenge has been cleared.",!1,"challenge",{previousChallengeId:t})},advanceJourney(e){const t=this.journeyProgress;this.journeyProgress+=e,this.addToGameLog(`Your journey has progressed by ${e} steps.`,!1,"action",{previousProgress:t,newProgress:this.journeyProgress,stepsAdded:e}),this.journeyProgress>=15&&(this.victoryConditions.journeyCompleted=!0,this.addToGameLog("You have completed your journey through the Celtic Realm!",!0,"system",{journeyProgress:this.journeyProgress,journeyCompleted:!0}),this.checkVictoryConditions()&&this.completeJourney(!0))},completeJourney(e){this.addToGameLog(e?"Congratulations! You have successfully completed your journey through the Celtic Realm!":"Your journey has come to an end, but not in victory.",!0,"system",{isVictory:e,journeyProgress:this.journeyProgress,victoryConditions:{...this.victoryConditions},visitedLandscapes:this.visitedLandscapes.length,currentTurn:this.currentTurn,currentSeason:this.formatSeason(this.currentSeason)}),this.endGame(e)},addToGameLog(e,t=!1,a="system",s={}){const n={message:e,timestamp:Date.now(),highlight:t,type:a,details:s,turn:this.currentTurn,season:this.currentSeason},o=new Date(n.timestamp),i=`${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}:${o.getSeconds().toString().padStart(2,"0")}`;n.message=`[${i}][${a.toUpperCase()}] ${e}`,"error"===a?console.error(n.message,s):"debug"===a?console.debug(n.message,s):console.log(n.message,s),this.gameLog.push(n),this.gameLog.length>100&&this.gameLog.shift()},checkVictoryConditions(){const e=Object.values(this.victoryConditions).every(Boolean);return e&&this.endGame(!0),e},formatPhase(e){return e.replace(/_/g," ").toLowerCase()},formatSeason(e){return e.replace(/_/g," ").toLowerCase()},addThreatTokens(e){const t=Math.floor(this.threatTokens/3);this.threatTokens+=e;const a=Math.floor(this.threatTokens/3);return a>t&&this.addToGameLog(`The threat level has increased to ${a}!`,!0),this.victoryConditions.balanceMaintained=this.threatTokens<6,this.threatTokens},removeThreatTokens(e){const t=Math.floor(this.threatTokens/3);this.threatTokens=Math.max(0,this.threatTokens-e);const a=Math.floor(this.threatTokens/3);return a<t&&this.addToGameLog(`The threat level has decreased to ${a}.`,!0),this.victoryConditions.balanceMaintained=this.threatTokens<6,this.threatTokens},addTempEffect(e,t,a,s,n){const o=this.tempEffects.findIndex((t=>t.id===e));-1!==o?(this.tempEffects[o].strength=s,this.tempEffects[o].duration=n):(this.tempEffects.push({id:e,name:t,description:a,strength:s,duration:n}),this.addToGameLog(`New effect: ${t} - ${a}`,!0))},removeTempEffect(e){const t=this.tempEffects.findIndex((t=>t.id===e));if(-1!==t){const e=this.tempEffects[t];return this.addToGameLog(`Effect ended: ${e.name}`,!0),this.tempEffects.splice(t,1),!0}return!1},processTempEffects(){this.tempEffects.forEach(((e,t)=>{e.duration>0&&(e.duration--,0===e.duration&&(this.addToGameLog(`Effect ended: ${e.name}`,!0),this.tempEffects.splice(t,1)))}))},clearGameLog(){this.gameLog=[],this.addToGameLog("Game log cleared.",!1,"system",{timestamp:Date.now()})},handleThreatLevelCheck(){const e=this.threatLevel;this.addToGameLog(`Threat Level Check: Current threat level is ${e}.`,!0),e>0&&this.addToGameLog(`Challenge difficulty increased by +${e} due to threat level.`),this.threatTokens>=10?(this.addToGameLog("DANGER: The otherworldly forces are manifesting! Rolling on the Otherworldly Manifestation table.",!0,"error"),this.triggerOtherworldlyManifestation()):this.threatTokens>=5&&(this.addToGameLog("WARNING: The spiritual balance is disturbed. Drawing a random event.",!0,"challenge"),this.triggerRandomEvent()),this.advancePhase()},triggerRandomEvent(){const e=[{id:"sudden_storm",name:"Sudden Storm",description:"Dark clouds gather suddenly, bringing a fierce storm.",effect:()=>{this.addToGameLog("The storm makes gathering resources more difficult. Resource capacity reduced by 1 temporarily.",!0),this.addTempEffect("storm","Sudden Storm","Resource capacity -1",1,2);const e=_();e.addEffect({id:"storm_effect",name:"Storm Hindrance",description:"Resource gathering diminished",type:"negative",magnitude:-1,duration:2,target:"resourceCapacity"})}},{id:"animal_migration",name:"Animal Migration",description:"A sudden migration of animals passes through the area.",effect:()=>{this.addToGameLog("The animal migration brings opportunity. Your next Animal Companion check gets +2.",!0),this.addTempEffect("migration","Animal Migration","Animal Companion checks +2",2,1)}},{id:"ancient_memory",name:"Ancient Memory",description:"The land itself seems to remember ancient events, stirring old magics.",effect:()=>{const e=_();e.gainExperience(1),this.addToGameLog("Ancient wisdom floods your mind. You gain 1 experience point.",!0)}},{id:"fae_mischief",name:"Fae Mischief",description:"The faerie folk play tricks on unwary travelers.",effect:()=>{this.addToGameLog("Your supplies have been tampered with by mischievous fae.",!0);const e=_();e.loseRandomResources(1)}},{id:"spiritual_blessing",name:"Spiritual Blessing",description:"The ancestral spirits take notice of your journey and offer aid.",effect:()=>{this.blessingTokens+=1,this.addToGameLog("You receive a blessing from the spirits. +1 Blessing token.",!0)}}],t=e[Math.floor(Math.random()*e.length)];this.addToGameLog(`Random Event: ${t.name} - ${t.description}`,!0),t.effect()},triggerOtherworldlyManifestation(){const e=[{id:"spirit_guardian",name:"Spirit Guardian",description:"A powerful guardian spirit manifests to test your worthiness.",effect:()=>{this.addToGameLog("The spirit guardian challenges you to prove your worth!",!0),this.addTempEffect("guardian_challenge","Spirit Guardian Challenge","Must succeed on next 2 challenges or lose 2 health",2,2),this.addToGameLog("You must succeed on your next two challenges or suffer 2 health damage.",!0)}},{id:"reality_distortion",name:"Reality Distortion",description:"The boundaries between worlds thin, causing strange distortions in reality.",effect:()=>{this.addToGameLog("Reality warps around you, changing your path!",!0);const e=T(),t=e.landscapes,a=t[Math.floor(Math.random()*t.length)];this.setCurrentLandscape(a.id),this.addToGameLog(`You suddenly find yourself at ${a.name}!`,!0)}},{id:"ancestral_curse",name:"Ancestral Curse",description:"Ancient spirits place a curse upon you for disturbing the balance.",effect:()=>{this.addToGameLog("An ancestral curse falls upon you!",!0);const e=_();e.addEffect({id:"ancestral_curse",name:"Ancestral Curse",description:"-1 to all challenge rolls",type:"negative",magnitude:-1,duration:3,target:"challengeRolls"}),this.addToGameLog("You feel weakened. -1 to all challenge rolls for 3 turns.",!0)}},{id:"otherworld_portal",name:"Otherworld Portal",description:"A portal to the Otherworld opens, risking pulling you in.",effect:()=>{if(this.addToGameLog("A swirling portal to the Otherworld appears before you!",!0),this.addThreatTokens(2),this.addToGameLog("The portal's energy increases the spiritual imbalance. +2 Threat tokens.",!0),this.addToGameLog("You sense that reaching into the portal could yield a valuable resource, but at great risk...",!0),Math.random()>.5){const e=_(),t=["silver_mistletoe","standing_stone_chips","amber_shards"][Math.floor(3*Math.random())];e.addResource(t),this.addToGameLog(`You reach into the portal and retrieve a rare resource: ${t.replace("_"," ")}!`,!0)}else{const e=_();e.loseHealth(2),this.addToGameLog("The portal's energy burns you as you reach in! You lose 2 health.",!0)}}},{id:"time_anomaly",name:"Time Anomaly",description:"Time flows strangely, affecting your progress and abilities.",effect:()=>{this.addToGameLog("Time becomes unstable around you!",!0),Math.random()>.5?(this.advanceSeason(),this.addToGameLog("Time accelerates, advancing the season prematurely!",!0)):(this.reverseSeason(),this.addToGameLog("Time flows backwards, returning to the previous season!",!0))}}],t=e[Math.floor(Math.random()*e.length)];this.addToGameLog(`Otherworldly Manifestation: ${t.name} - ${t.description}`,!0,"error"),t.effect()},reverseSeason(){const e=[E.SAMHAIN,E.WINTERS_DEPTH,E.IMBOLC,E.BELTANE,E.LUGHNASADH],t=e.indexOf(this.currentSeason);if(t>0){const a=e[t-1];this.currentSeason=a,this.addToGameLog(`The season has reversed to ${this.formatSeason(this.currentSeason)}.`,!0)}else this.addToGameLog("The season remains unchanged - you are already at the beginning of the cycle.",!0);this.updateSeasonCard()},handleHealingRecovery(){const e=_(),t=1,a=this.currentSeasonCard;let s=0;a&&(this.currentSeason===E.IMBOLC?s=1:this.currentSeason===E.LUGHNASADH&&(s=0,this.addToGameLog("The community support during Lughnasadh doubles your healing effectiveness.")));const n=t+s;if(e.health<e.maxHealth?(e.healHealth(n),this.addToGameLog(`You recover ${n} health during the healing phase.`,!0,"system")):this.addToGameLog("You are already at full health.",!1,"system"),this.currentLandscape&&["Sacred Oak Grove","Druid's Sanctuary","Moonlit Loch"].includes(this.currentLandscape.name)){const t=1;e.healHealth(t),this.addToGameLog(`The spiritual energy at this ${this.currentLandscape.name} provides an additional ${t} healing.`,!0)}this.advancePhase()},processSeasonalResourceChanges(e,t){const a=_(),s=T(),n=[...a.resources];this.addToGameLog("Checking resources for seasonal changes...",!1,"system");const o={[`${E.SAMHAIN}_${E.WINTERS_DEPTH}`]:["berries","mushrooms","fresh_herbs"],[`${E.WINTERS_DEPTH}_${E.IMBOLC}`]:["winter_roots","preserved_meats"],[`${E.IMBOLC}_${E.BELTANE}`]:["spring_flowers","birch_sap"],[`${E.BELTANE}_${E.LUGHNASADH}`]:["summer_fruits","fresh_water"],[`${E.LUGHNASADH}_${E.SAMHAIN}`]:["summer_fruits","fresh_water"]},i={[`${E.SAMHAIN}_${E.WINTERS_DEPTH}`]:{acorns:"winter_roots",fresh_herbs:"dried_herbs"},[`${E.WINTERS_DEPTH}_${E.IMBOLC}`]:{snow_essence:"spring_water",pine_needles:"spring_flowers"},[`${E.IMBOLC}_${E.BELTANE}`]:{spring_flowers:"summer_fruits",birch_sap:"sweet_syrup"},[`${E.BELTANE}_${E.LUGHNASADH}`]:{green_leaves:"red_leaves",summer_fruits:"fermented_fruit"}},r=`${e}_${t}`,c=o[r]||[],l=i[r]||{};n.forEach((e=>{if(c.includes(e)&&(a.removeResource(e),this.addToGameLog(`Your ${this.formatResourceName(e)} has spoiled with the change to ${this.formatSeason(t)}.`,!0,"resource")),e in l){const n=l[e];a.removeResource(e),a.addResource(n);const o=s.getResourceById(e),i=s.getResourceById(n),r=o?o.name:this.formatResourceName(e),c=i?i.name:this.formatResourceName(n);this.addToGameLog(`Your ${r} has transformed into ${c} with the change to ${this.formatSeason(t)}.`,!0,"resource")}})),this.updateResourceAvailability()},formatResourceName(e){return e.replace(/_/g," ")},updateResourceAvailability(){this.addToGameLog("Resource availability has adjusted to the new season.",!1,"system")},rollD8(){const e=Math.floor(8*Math.random())+1;return this.addToGameLog(`You rolled a ${e} on a D8.`,!0,"system"),e},resolveChallenge(e,t){return this.addToGameLog(`Challenge attempt: Roll ${e} vs Difficulty ${t}`,!0,"challenge"),e>=t+2?(this.addToGameLog("Critical Success! You overcome the challenge with exceptional results.",!0,"challenge"),this.currentChallenge&&this.challengeHistory.push({id:this.currentChallenge,outcome:"SUCCESS",turn:this.currentTurn}),this.removeThreatTokens(1),"SUCCESS"):e>=t?(this.addToGameLog("Success! You overcome the challenge.",!0,"challenge"),this.currentChallenge&&this.challengeHistory.push({id:this.currentChallenge,outcome:"SUCCESS",turn:this.currentTurn}),"SUCCESS"):e>=t-2?(this.addToGameLog("Partial Success. You manage to barely overcome parts of the challenge.",!0,"challenge"),this.currentChallenge&&this.challengeHistory.push({id:this.currentChallenge,outcome:"PARTIAL",turn:this.currentTurn}),this.addThreatTokens(1),"PARTIAL"):(this.addToGameLog("Failure. The challenge proves too difficult for now.",!0,"challenge"),this.currentChallenge&&this.challengeHistory.push({id:this.currentChallenge,outcome:"FAILURE",turn:this.currentTurn}),this.addThreatTokens(2),"FAILURE")},performSpecialAction(e){T();const t=_();switch(e){case"standing_stones_ceremony":return this.ceremonyCompleted=!0,this.journeyComplete=!0,t.wisdom=(t.wisdom||0)+5,this.addToGameLog("You have performed the ancient ceremony at the Standing Stones. Your journey is complete!",!0,"special"),{success:!0,message:"You have successfully completed the journey!"};case"heal_at_spring":return t.healHealth(5),this.addToGameLog("You drink from the sacred spring and feel revitalized.",!0,"special"),{success:!0,message:"You feel refreshed and healed."};case"meditation":return t.wisdom=(t.wisdom||0)+2,this.addToGameLog("You meditate peacefully, gaining insight and wisdom.",!0,"special"),{success:!0,message:"Your mind feels clearer and wiser."};default:return{success:!1,message:"That action is not available at this location."}}}}});class A{checkVictoryConditions(){const e=this.checkJourneyCompletion(),t=this.checkBalanceMaintained(),a=this.checkKnowledgeAcquired(),s=this.checkBondsFormed(),n=this.checkPersonalQuest(),o=this.checkLandscapesTraversed(),i=this.checkSeasonsExperienced(),r=this.checkChallengesOvercome(),c={journeyCompleted:e,balanceMaintained:t,knowledgeAcquired:a,bondsFormed:s,questFulfilled:n,landscapesTraversed:o,seasonsExperienced:i,challengesOvercome:r},l=Object.values(c).every(Boolean),d=b();return d.victoryConditions=c,{isVictory:l,conditions:c}}checkJourneyCompletion(){const e=b();return e.visitedLandscapes.length>=15}checkBalanceMaintained(){const e=b();return e.threatTokens<6}checkKnowledgeAcquired(){const e=_();return e.craftedItems.length>=2}checkBondsFormed(){const e=_();return e.animalCompanions.length>=1}checkPersonalQuest(){const e=_(),t=T(),a=b(),s=t.getCharacterById(e.characterId);if(!s)return!1;switch(s.id){case"giant_beastfriend":return e.companionCount>=4;case"hedge_witch":return e.craftedItemCount>=3;case"iron_crafter":return e.craftedItemCount>=5;case"druid_seer":return a.visitedLandscapes.length>=10;case"celtic_warrior":return a.visitedLandscapes.length>=12;case"forest_guardian":return 0===a.threatTokens;default:return!1}}checkLandscapesTraversed(){const e=b();return e.visitedLandscapes.length>=10}checkSeasonsExperienced(){b();return!0}checkChallengesOvercome(){b();return!0}processVictory(){const e=b();e.endGame(!0),e.addToGameLog("Victory! You have completed your journey through the Celtic Realm.",!0)}processDefeat(e){const t=b();t.endGame(!1),t.addToGameLog(`Defeat: ${e}`,!0),t.addToGameLog(`Game Stats - Turns: ${t.currentTurn}, Threat: ${t.threatTokens}, Season: ${t.currentSeason}`,!1)}checkDefeatConditions(){const e=b(),t=_();return t.health<=0?{isDefeat:!0,reason:"Your journey has ended as your health has fallen to zero."}:e.threatTokens>=15?{isDefeat:!0,reason:"The otherworldly forces have overwhelmed you as threat tokens reached 15."}:e.currentTurn>=30?{isDefeat:!0,reason:"Your journey has taken too long, and winter has claimed you."}:{isDefeat:!1,reason:null}}}const R=new A,_=(0,n.nY)("player",{state:()=>({characterId:"",health:10,maxHealth:10,resources:[],resourceCapacity:5,animalCompanions:[],craftedItems:[],experience:0,knowledgeDiscovered:[],specialAbilityUsed:!1,activeEffects:[],hasCraftedLegendaryItem:!1,uniqueCraftedItemsCount:0,companionLoyalty:{},wisdom:0}),getters:{character(){const e=T(),t=e.getCharacterById(this.characterId);return t||null},resourceCount(){return this.resources.length},isResourceCapacityReached(){return this.resources.length>=this.resourceCapacity},companionCount(){return this.animalCompanions.length},craftedItemCount(){return this.craftedItems.length},experienceLevel(){return Math.floor(this.experience/3)+1},hasEffect(){return e=>this.activeEffects.some((t=>t.id===e&&t.duration>0))},getEffectStrength(){return e=>{const t=this.activeEffects.find((t=>t.id===e&&t.duration>0));return t?t.magnitude:0}}},actions:{setCharacter(e){const t=T(),a=t.getCharacterById(e);a&&(this.characterId=e,this.health=a.healthPoints,this.maxHealth=a.healthPoints,this.resourceCapacity=a.resourceCapacity,a.startingResources&&a.startingResources.forEach((e=>{this.addResource(e)})),a.startingCompanion&&this.addAnimalCompanion(a.startingCompanion),a.startingCompanions&&a.startingCompanions.forEach((e=>{this.addAnimalCompanion(e)})))},selectCharacter(e){return this.setCharacter(e),!0},addResource(e){return this.resources.length<this.resourceCapacity&&(this.resources.push(e),!0)},removeResource(e){const t=this.resources.indexOf(e);return-1!==t&&(this.resources.splice(t,1),!0)},addAnimalCompanion(e){return!this.animalCompanions.includes(e)&&(this.animalCompanions.push(e),this.companionLoyalty[e]={loyalty:5,state:p.LOYAL,turnsSinceLastFed:0,turnsWary:0},!0)},removeAnimalCompanion(e){const t=this.animalCompanions.indexOf(e);return-1!==t&&(this.animalCompanions.splice(t,1),this.companionLoyalty[e]&&delete this.companionLoyalty[e],!0)},feedCompanion(e,t){if(!this.animalCompanions.includes(e))return!1;if(!this.resources.includes(t))return!1;this.removeResource(t);const a=this.companionLoyalty[e];a||(this.companionLoyalty[e]={loyalty:5,state:p.LOYAL,turnsSinceLastFed:0,turnsWary:0});const s=this.companionLoyalty[e];s.turnsSinceLastFed=0,s.loyalty=Math.min(10,s.loyalty+1),s.state===p.WARY&&(s.state=p.LOYAL,s.turnsWary=0);const n=b();return n.addToGameLog(`You fed your animal companion with ${n.formatResourceName(t)}.`,!0,"companion"),!0},updateCompanionStatus(){const e=b(),t=T();this.animalCompanions.forEach((a=>{const s=this.companionLoyalty[a];if(!s)return;s.turnsSinceLastFed++;const n=t.getAnimalCompanionById(a),o=n?n.name:"Animal companion";s.state===p.LOYAL&&s.turnsSinceLastFed>=3&&(s.state=p.WARY,s.turnsWary=0,e.addToGameLog(`${o} has become wary due to lack of food.`,!0,"companion")),s.state===p.WARY&&(s.turnsWary++,s.turnsWary>=2&&(s.state=p.LEAVING,e.addToGameLog(`${o} is leaving you due to continued neglect.`,!0,"companion"))),s.state===p.LEAVING&&(this.removeAnimalCompanion(a),e.addToGameLog(`${o} has left you.`,!0,"companion"))}))},isCompanionInState(e,t){if(!this.animalCompanions.includes(e))return!1;const a=this.companionLoyalty[e];return!!a&&a.state===t},getCompanionsInState(e){return this.animalCompanions.filter((t=>{const a=this.companionLoyalty[t];return a&&a.state===e}))},addCraftedItem(e){return!this.craftedItems.includes(e)&&(this.craftedItems.push(e),!0)},removeCraftedItem(e){const t=this.craftedItems.indexOf(e);return-1!==t&&(this.craftedItems.splice(t,1),!0)},addExperience(e){return this.experience+=e,this.experience},gainExperience(e){return this.addExperience(e)},loseHealth(e){if(this.health=Math.max(0,this.health-e),this.health<=0){const e=R.checkDefeatConditions();e.isDefeat&&R.processDefeat(e.reason||"Your health has reached zero.")}return this.health>0},healHealth(e){return this.health=Math.min(this.maxHealth,this.health+e),this.health},discoverKnowledge(e){return!this.knowledgeDiscovered.includes(e)&&(this.knowledgeDiscovered.push(e),!0)},useSpecialAbility(){return!this.specialAbilityUsed&&(this.specialAbilityUsed=!0,!0)},resetSpecialAbility(){return this.specialAbilityUsed=!1,!0},resetPlayer(){this.characterId="",this.health=10,this.maxHealth=10,this.resources=[],this.resourceCapacity=5,this.animalCompanions=[],this.craftedItems=[],this.experience=0,this.knowledgeDiscovered=[],this.specialAbilityUsed=!1,this.activeEffects=[],this.hasCraftedLegendaryItem=!1,this.uniqueCraftedItemsCount=0,this.companionLoyalty={}},addCompanion(e){this.animalCompanions.includes(e)||(this.animalCompanions.push(e),this.companionLoyalty||(this.companionLoyalty={}),this.companionLoyalty[e]=1)},removeCompanion(e){this.animalCompanions=this.animalCompanions.filter((t=>t!==e)),this.companionLoyalty&&this.companionLoyalty[e]&&delete this.companionLoyalty[e]},setCompanionLoyalty(e,t){this.companionLoyalty||(this.companionLoyalty={}),this.companionLoyalty[e]=t},takeDamage(e){const t=b(),a=this.loseHealth(e);return t.addToGameLog(`You take ${e} damage. Health: ${this.health}/${this.maxHealth}`),a||(t.addToGameLog("You have been defeated!",!0),t.endGame(!1)),a},loseRandomResources(e){const t=b();let a=0;e=Math.min(e,this.resources.length);for(let s=0;s<e;s++)if(this.resources.length>0){const e=Math.floor(Math.random()*this.resources.length),s=this.resources[e],n=T(),o=n.getResourceById(s);this.resources.splice(e,1),a++,t.addToGameLog(`You lost ${o?o.name:"a resource"}.`)}return a},addEffect(e){const t=b(),a=this.activeEffects.findIndex((t=>t.id===e.id));return-1!==a?(this.activeEffects[a].magnitude=e.magnitude,this.activeEffects[a].duration=e.duration,t.addToGameLog(`Effect renewed: ${e.name}`,!0)):(this.activeEffects.push(e),t.addToGameLog(`New effect gained: ${e.name} - ${e.description}`,!0)),!0},removeEffect(e){const t=b(),a=this.activeEffects.findIndex((t=>t.id===e));if(-1!==a){const e=this.activeEffects[a];return t.addToGameLog(`Effect ended: ${e.name}`,!0),this.activeEffects.splice(a,1),!0}return!1},processEffects(){this.activeEffects.forEach(((e,t)=>{if(e.duration>0&&(e.duration--,0===e.duration)){const a=b();a.addToGameLog(`Effect ended: ${e.name}`,!0),this.activeEffects.splice(t,1)}}))},useCompanionAbility(e){if(!this.animalCompanions.includes(e))return!1;const t=this.companionLoyalty[e];if(!t||t.state!==p.LOYAL)return!1;const a=T(),s=b(),n=a.getCompanionById(e);return!!n&&(s.addToGameLog(`You use ${n.name}'s special ability: ${n.ability.description}`,!0,"companion"),!0)},getCompanionStatus(e){if(!this.animalCompanions.includes(e))return p.LEAVING;const t=this.companionLoyalty[e];return t?t.state:p.LOYAL},useCraftedItem(e){if(!this.craftedItems.includes(e))return!1;const t=T(),a=b(),s=t.getCraftedItemById(e);return!!s&&(a.addToGameLog(`You use ${s.name}: ${s.description}`,!0,"crafting"),!0)},useCompanionForChallenge(e){if(!this.animalCompanions.includes(e))return!1;const t=this.companionLoyalty[e];if(!t||t.state!==p.LOYAL)return!1;const a=T(),s=b(),n=a.getCompanionById(e);return!!n&&(s.addToGameLog(`${n.name} helps you with the challenge.`,!0,"companion"),!0)},useCompanionForNight(e){if(!this.animalCompanions.includes(e))return!1;const t=this.companionLoyalty[e];if(!t||t.state!==p.LOYAL)return!1;const a=T(),s=b(),n=a.getCompanionById(e);return!!n&&(s.addToGameLog(`${n.name} keeps watch over you during the night.`,!0,"companion"),!0)},getCraftableItems(){const e=T(),t=e.getAllCraftedItems().map((e=>e.id)),a=[];for(const s of t){const t=e.getCraftedItemById(s);if(!t||!t.requiredResources)continue;let n=!0;for(const e of t.requiredResources)if(!this.resources.includes(e)){n=!1;break}n&&a.push(s)}return a},craftItem(e){const t=T(),a=b(),s=t.getCraftedItemById(e);if(!s||!s.requiredResources)return!1;for(const n of s.requiredResources)if(!this.resources.includes(n))return!1;for(const n of s.requiredResources)this.removeResource(n);return this.addCraftedItem(e),a.addToGameLog(`You crafted ${s.name}.`,!0,"crafting"),!0},rest(){const e=b();return this.healHealth(1),e.addToGameLog(`You rest and recover. Health is now ${this.health}/${this.maxHealth}.`,!0,"system"),!0},useCompanionForGathering(e){if(!this.animalCompanions.includes(e))return!1;const t=this.companionLoyalty[e];if(!t||t.state!==p.LOYAL)return!1;const a=T(),s=b(),n=a.getCompanionById(e);return!!n&&(s.addToGameLog(`${n.name} helps you gather resources.`,!0,"companion"),!0)}}}),k={class:"game-setup"},I={class:"game-container"},w={class:"character-selection"},N=["onClick"],O={class:"character-stats"},G={class:"stat"},M={class:"stat"},H={class:"character-abilities"},D=["onClick"];var P=(0,o.pM)({__name:"GameSetupView",setup(e){const t=(0,f.rd)(),a=_(),n=b(),i=T(),r=(0,v.KR)([]),c=(0,v.KR)(null),l=()=>{i.initialized||i.initializeCards(),r.value=i.characters},d=e=>{c.value=e},u=e=>e.specialAbility?.name||"",h=e=>e.specialAbility?.description||"",m=e=>{try{if(console.log("Starting game with character:",e.name),a.selectCharacter(e.id),n.startGame(),n.setPhase(S.SEASONAL_ASSESSMENT),n.addToGameLog(`You begin your journey as ${e.name}.`,!0,"system"),!n.currentLandscapeId){const e=i.landscapes;if(e.length>0){const t=e[0];if(n.setCurrentLandscape(t.id),t.challenges&&t.challenges.length>0){const e=t.challenges[0];n.setCurrentChallenge(e.id),console.log("Set initial challenge:",e.name)}}}console.log("Navigating to game board"),setTimeout((()=>{t.push("/game")}),50)}catch(s){console.error("Error starting game:",s),alert("There was an error starting your adventure. Please try again.")}};return l(),(e,t)=>((0,o.uX)(),(0,o.CE)("div",k,[(0,o.Lk)("div",I,[t[2]||(t[2]=(0,o.Fv)('<div class="game-header" data-v-77d55e09><h1 class="game-title" data-v-77d55e09>Game Setup</h1><p class="game-subtitle" data-v-77d55e09>Choose your character and begin your journey through the mystical Celtic landscape.</p></div><div class="celtic-quote" data-v-77d55e09> &quot;The journey through the Celtic Realm is one of discovery, challenge, and transformation.&quot; </div><h2 data-v-77d55e09>Select Your Character</h2><p class="character-intro mb-4" data-v-77d55e09> Each character brings unique abilities and challenges to your journey. Choose wisely, as your character&#39;s strengths and weaknesses will shape your path through the Celtic Realm. </p>',4)),(0,o.Lk)("div",w,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.value,(e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:(0,y.C4)(["character-card",{selected:c.value&&c.value.id===e.id}]),onClick:t=>d(e)},[(0,o.Lk)("h3",null,(0,y.v_)(e.name),1),(0,o.Lk)("p",null,(0,y.v_)(e.description),1),(0,o.Lk)("div",O,[(0,o.Lk)("div",G,[t[0]||(t[0]=(0,o.Lk)("span",{class:"stat-label"},"Health:",-1)),(0,o.eW)(" "+(0,y.v_)(e.healthPoints),1)]),(0,o.Lk)("div",M,[t[1]||(t[1]=(0,o.Lk)("span",{class:"stat-label"},"Capacity:",-1)),(0,o.eW)(" "+(0,y.v_)(e.resourceCapacity),1)])]),(0,o.Lk)("div",H,[(0,o.Lk)("strong",null,(0,y.v_)(u(e))+":",1),(0,o.eW)(" "+(0,y.v_)(h(e)),1)]),(0,o.Lk)("button",{class:"select-btn",onClick:(0,s.D$)((t=>m(e)),["stop"])},"Start Adventure",8,D)],10,N)))),128))])])]))}});const $=(0,l.A)(P,[["__scopeId","data-v-77d55e09"]]);var B=$;const F={class:"companion-management"},x={class:"companion-management__header"},Y={class:"companion-management__content"},W={key:0,class:"empty-state"},U={key:1,class:"companion-cards"},X={class:"available-companions"},j={key:0,class:"empty-state"},q={key:1,class:"companion-cards"},V=["onClick"],z={class:"available-companion-card__header"},K={class:"available-companion-card__content"},J={class:"companion-ability mt-2"},Q={class:"ability-description"},Z={class:"companion-seasons mt-2"},ee={class:"season-tags"},te={class:"available-companion-card__footer"},ae=["onClick","disabled"],se={key:0,class:"feed-dialog-overlay"},ne={class:"feed-dialog"},oe={class:"feed-dialog__header"},ie={class:"feed-dialog__content"},re={class:"resource-list"},ce=["onClick"],le={class:"feed-dialog__footer"},de=["disabled"];function ue(e,t,a,n,i,r){const c=(0,o.g2)("CompanionCard");return(0,o.uX)(),(0,o.CE)("div",F,[(0,o.Lk)("div",x,[t[4]||(t[4]=(0,o.Lk)("h2",{class:"companion-management__title"},"Animal Companions",-1)),(0,o.Lk)("button",{class:"btn btn--icon",onClick:t[0]||(t[0]=(...t)=>e.emitClose&&e.emitClose(...t))},"×")]),(0,o.Lk)("div",Y,[0===e.playerCompanions.length?((0,o.uX)(),(0,o.CE)("div",W,t[5]||(t[5]=[(0,o.Lk)("p",null,"You haven't bonded with any animal companions yet.",-1),(0,o.Lk)("p",null,"Find a suitable companion and use a resource to form a bond.",-1)]))):((0,o.uX)(),(0,o.CE)("div",U,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.playerCompanions,(t=>((0,o.uX)(),(0,o.Wv)(c,{key:t,companionId:t,abilityUsed:e.usedCompanionAbilities.includes(t),canFeed:e.hasCompatibleResources(t),onSelect:e.selectCompanion,onFeed:e.openFeedDialog,onUseAbility:e.useCompanionAbility},null,8,["companionId","abilityUsed","canFeed","onSelect","onFeed","onUseAbility"])))),128))]))]),t[9]||(t[9]=(0,o.Lk)("h3",{class:"mt-4"},"Available Companions",-1)),(0,o.Lk)("div",X,[0===e.availableCompanions.length?((0,o.uX)(),(0,o.CE)("div",j,t[6]||(t[6]=[(0,o.Lk)("p",null,"No companions are available in this area.",-1),(0,o.Lk)("p",null,"Continue exploring to find potential companions.",-1)]))):((0,o.uX)(),(0,o.CE)("div",q,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.availableCompanions,(a=>((0,o.uX)(),(0,o.CE)("div",{key:a.id,class:"available-companion-card",onClick:t=>e.selectAvailableCompanion(a.id)},[(0,o.Lk)("div",z,[(0,o.Lk)("h4",null,(0,y.v_)(a.name),1)]),(0,o.Lk)("div",K,[(0,o.Lk)("p",null,(0,y.v_)(a.description),1),(0,o.Lk)("div",J,[(0,o.Lk)("h5",null,(0,y.v_)(a.ability.name),1),(0,o.Lk)("p",Q,(0,y.v_)(a.ability.description),1)]),(0,o.Lk)("div",Z,[t[7]||(t[7]=(0,o.Lk)("h5",null,"Seasonal Affinity",-1)),(0,o.Lk)("div",ee,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.affinitySeasons,(t=>((0,o.uX)(),(0,o.CE)("span",{key:t,class:(0,y.C4)(["season-tag",t.toLowerCase()])},(0,y.v_)(e.formatSeasonName(t)),3)))),128))])])]),(0,o.Lk)("div",te,[(0,o.Lk)("button",{class:"btn btn--primary",onClick:(0,s.D$)((t=>e.openBondDialog(a.id)),["stop"]),disabled:!e.hasResourcesForBonding(a.id)}," Bond ",8,ae)])],8,V)))),128))]))]),e.showBondDialog?((0,o.uX)(),(0,o.CE)("div",se,[(0,o.Lk)("div",ne,[(0,o.Lk)("div",oe,[(0,o.Lk)("h3",null,"Bond with "+(0,y.v_)(e.selectedCompanionName),1),(0,o.Lk)("button",{class:"close-btn",onClick:t[1]||(t[1]=(...t)=>e.closeBondDialog&&e.closeBondDialog(...t))},"×")]),(0,o.Lk)("div",ie,[t[8]||(t[8]=(0,o.Lk)("p",null,"Select a resource to form a bond:",-1)),(0,o.Lk)("div",re,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.compatibleResources,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:(0,y.C4)(["resource-item",{selected:e.selectedResource===t.id}]),onClick:a=>e.selectedResource=t.id},[(0,o.Lk)("span",null,(0,y.v_)(t.name),1)],10,ce)))),128))])]),(0,o.Lk)("div",le,[(0,o.Lk)("button",{class:"btn btn--primary",onClick:t[2]||(t[2]=(...t)=>e.bondWithCompanion&&e.bondWithCompanion(...t)),disabled:!e.selectedResource}," Bond ",8,de),(0,o.Lk)("button",{class:"btn btn--secondary",onClick:t[3]||(t[3]=(...t)=>e.closeBondDialog&&e.closeBondDialog(...t))}," Cancel ")])])])):(0,o.Q3)("",!0)])}class he{bondWithCompanion(e,t){const a=_(),s=T();if(a.animalCompanions.includes(e))return!1;const n=s.getCompanionById(e);return!!n&&(!!this.isResourceSuitableForBonding(t,e)&&(!!a.removeResource(t)&&(a.addCompanion(e),this.applyBondingEffects(e),!0)))}isResourceSuitableForBonding(e,t){const a=T(),s=a.getResourceById(e),n=a.getCompanionById(t);return!(!s||!n)&&(n.preferredResources&&n.preferredResources.includes(e))}feedCompanion(e,t){const a=_();return!!a.animalCompanions.includes(e)&&(!!this.isResourceSuitableForBonding(t,e)&&(!!a.removeResource(t)&&(this.increaseLoyalty(e),!0)))}getLoyalty(e){const t=_();if(!t.animalCompanions.includes(e))return 0;const a=t.companionLoyalty[e];return a&&"object"===typeof a&&"loyalty"in a?a.loyalty:0}increaseLoyalty(e){const t=_();if(!t.animalCompanions.includes(e))return 0;const a=t.companionLoyalty[e],s=a&&"object"===typeof a&&"loyalty"in a?a.loyalty:0,n=Math.min(s+1,5);return t.setCompanionLoyalty(e,n),this.applyLoyaltyEffects(e,n),n}decreaseLoyalty(e){const t=_();if(!t.animalCompanions.includes(e))return 0;const a=t.companionLoyalty[e],s=a&&"object"===typeof a&&"loyalty"in a?a.loyalty:0,n=Math.max(s-1,0);return t.setCompanionLoyalty(e,n),0===n?(t.removeCompanion(e),-1):(this.applyLoyaltyEffects(e,n),n)}getCompanionsForChallengeType(e){const t=_(),a=T();return t.animalCompanions.filter((t=>{const s=a.getCompanionById(t);return s&&s.challengeBonuses&&s.challengeBonuses[e]>0}))}selectRandomCompanion(){const e=T(),t=_(),a=b(),s=a.currentLandscapeId,n=a.currentSeason;if(!s||!n)return"";const o={sacred_oak_grove:["wolf","deer","bear","boar"],faerie_knoll:["fox","hare"],moonlit_loch:["salmon","owl"],whispering_heath:["raven"],wild_horse_plain:["horse"]};if(!o[s])return"";const i=o[s],r=e.animalCompanions.filter((e=>{if(t.animalCompanions.includes(e.id))return!1;const a=e.id.split("_")[0].toLowerCase();return i.includes(a)}));return r.length>0?r[Math.floor(Math.random()*r.length)].id:""}isCompanionWary(e){const t=_();if(!t.animalCompanions.includes(e))return!1;const a=t.companionLoyalty[e];return a&&"object"===typeof a&&"state"in a&&a.state===p.WARY}applyBondingEffects(e){const t=T(),a=_(),s=t.getCompanionById(e);s&&s.bondingEffect&&s.bondingEffect(a)}applyLoyaltyEffects(e,t){const a=T(),s=_(),n=a.getCompanionById(e);if(!n||!n.loyaltyEffects)return;const o=n.loyaltyEffects[t];o&&o(s)}}const me=new he,pe={class:"companion-card__content"},ge={class:"companion-loyalty mt-3"},fe={class:"loyalty-meter"},ye={key:0,class:"companion-ability mt-3"},ve={class:"ability-effect"},Ce={key:1,class:"companion-seasons mt-3"},Le={class:"season-tags"},Ee={class:"companion-card__actions"},Te=["disabled"],Se={key:0,class:"feed-dialog-overlay"},be={class:"feed-dialog"},Ae={class:"feed-dialog__header"},Re={class:"feed-dialog__content"},_e={class:"resource-list"},ke=["onClick"],Ie={key:0,class:"empty-state"},we={class:"feed-dialog__footer"},Ne=["disabled"];function Oe(e,t,a,n,i,r){const c=(0,o.g2)("GameCard");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(c,{title:e.companion?.name||"Unknown Companion",subtitle:"Animal Companion",cardType:e.CardType.ANIMAL_COMPANION,class:(0,y.C4)(["companion-card",{wary:e.isCompanionWary}]),onClick:e.selectCompanion,style:{border:"2px solid lightblue",position:"relative"}},{footer:(0,o.k6)((()=>[(0,o.Lk)("div",Ee,[e.canFeed?((0,o.uX)(),(0,o.CE)("button",{key:0,class:"btn btn--primary",onClick:t[0]||(t[0]=(0,s.D$)(((...t)=>e.openFeedDialog&&e.openFeedDialog(...t)),["stop"]))}," Feed Companion ")):(0,o.Q3)("",!0),(0,o.Lk)("button",{class:"btn btn--secondary",onClick:t[1]||(t[1]=(0,s.D$)(((...t)=>e.useAbility&&e.useAbility(...t)),["stop"])),disabled:e.abilityUsed||e.isCompanionWary},(0,y.v_)(e.isCompanionWary?"Wary":e.abilityUsed?"Ability Used":"Use Ability"),9,Te)])])),default:(0,o.k6)((()=>[t[6]||(t[6]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"CompanionCard",-1)),(0,o.Lk)("div",pe,[(0,o.Lk)("p",null,(0,y.v_)(e.companion?.description||"No description available"),1),(0,o.Lk)("div",ge,[(0,o.Lk)("h5",null,"Loyalty Level: "+(0,y.v_)(e.loyalty),1),(0,o.Lk)("div",fe,[(0,o.Lk)("div",{class:"loyalty-bar",style:(0,y.Tr)(e.loyaltyBarStyle)},null,4)])]),e.companion?.ability?((0,o.uX)(),(0,o.CE)("div",ye,[(0,o.Lk)("h5",null,(0,y.v_)(e.companion.ability.name),1),(0,o.Lk)("p",null,(0,y.v_)(e.companion.ability.description),1),(0,o.Lk)("p",ve,(0,y.v_)(e.companion.ability.effect),1)])):(0,o.Q3)("",!0),e.companion?.affinitySeasons?((0,o.uX)(),(0,o.CE)("div",Ce,[t[5]||(t[5]=(0,o.Lk)("h5",null,"Seasonal Affinity",-1)),(0,o.Lk)("div",Le,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.companion.affinitySeasons,(t=>((0,o.uX)(),(0,o.CE)("span",{key:t,class:(0,y.C4)(["season-tag",t.toLowerCase()])},(0,y.v_)(e.formatSeasonName(t)),3)))),128))])])):(0,o.Q3)("",!0)])])),_:1},8,["title","cardType","class","onClick"]),e.showFeedDialog?((0,o.uX)(),(0,o.CE)("div",Se,[(0,o.Lk)("div",be,[(0,o.Lk)("div",Ae,[(0,o.Lk)("h3",null,"Feed "+(0,y.v_)(e.companion?.name),1),(0,o.Lk)("button",{class:"close-btn",onClick:t[2]||(t[2]=(...t)=>e.closeFeedDialog&&e.closeFeedDialog(...t))},"×")]),(0,o.Lk)("div",Re,[t[7]||(t[7]=(0,o.Lk)("p",null,"Select a resource to feed your companion:",-1)),(0,o.Lk)("div",_e,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.compatibleResources,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:(0,y.C4)(["resource-item",{selected:e.selectedResource===t.id}]),onClick:a=>e.selectedResource=t.id},[(0,o.Lk)("span",null,(0,y.v_)(t.name),1)],10,ke)))),128)),0===e.compatibleResources.length?((0,o.uX)(),(0,o.CE)("div",Ie," No compatible resources available. ")):(0,o.Q3)("",!0)])]),(0,o.Lk)("div",we,[(0,o.Lk)("button",{class:"btn btn--primary",onClick:t[3]||(t[3]=(...t)=>e.feedCompanion&&e.feedCompanion(...t)),disabled:!e.selectedResource||0===e.compatibleResources.length}," Feed ",8,Ne),(0,o.Lk)("button",{class:"btn btn--secondary",onClick:t[4]||(t[4]=(...t)=>e.closeFeedDialog&&e.closeFeedDialog(...t))}," Cancel ")])])])):(0,o.Q3)("",!0)],64)}const Ge={style:{position:"absolute",top:"5px",left:"5px","font-size":"0.8rem","font-weight":"bold","text-transform":"uppercase"}},Me={style:{"font-size":"1rem","margin-top":"2px"}},He={style:{position:"absolute",bottom:"5px",right:"5px","font-size":"0.8rem","font-weight":"bold","text-transform":"uppercase",transform:"rotate(180deg)"}},De={style:{"font-size":"1rem","margin-top":"2px"}},Pe={class:"game-card__header",style:{"border-top-left-radius":"12px","border-top-right-radius":"12px",padding:"10px","text-align":"center"}},$e={style:{margin:"0","font-size":"1.2rem","text-transform":"capitalize"}},Be={key:0,class:"game-card__subtitle",style:{"font-size":"0.8rem",opacity:"0.8"}},Fe={style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","font-size":"3rem",opacity:"0.1","pointer-events":"none"}},xe={class:"game-card__body",style:{"flex-grow":"1",display:"flex","align-items":"center","justify-content":"center","text-align":"center",padding:"15px","z-index":"1"}},Ye={key:0,class:"game-card__footer",style:{"border-bottom-left-radius":"12px","border-bottom-right-radius":"12px",padding:"10px","text-align":"center"}};function We(e,t,a,s,n,i){return(0,o.uX)(),(0,o.CE)("div",{class:(0,y.C4)(["game-card",e.cardTypeClass]),onClick:t[0]||(t[0]=t=>e.$emit("click",t)),style:{border:"2px solid lightblue",position:"relative","border-radius":"12px","aspect-ratio":"2.5/3.5",display:"flex","flex-direction":"column","box-shadow":"3px 3px 8px rgba(0,0,0,0.2)","background-color":"#f8f8f8",overflow:"hidden"}},[t[1]||(t[1]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"GameCard",-1)),(0,o.Lk)("div",Ge,[(0,o.eW)((0,y.v_)(e.title.charAt(0))+" ",1),(0,o.Lk)("div",Me,(0,y.v_)(e.getSuitSymbol()),1)]),(0,o.Lk)("div",He,[(0,o.eW)((0,y.v_)(e.title.charAt(0))+" ",1),(0,o.Lk)("div",De,(0,y.v_)(e.getSuitSymbol()),1)]),(0,o.Lk)("div",Pe,[(0,o.Lk)("h3",$e,(0,y.v_)(e.title),1),e.subtitle?((0,o.uX)(),(0,o.CE)("div",Be,(0,y.v_)(e.subtitle),1)):(0,o.Q3)("",!0)]),t[2]||(t[2]=(0,o.Lk)("div",{style:{position:"absolute",top:"40px",left:"0",right:"0",bottom:"40px",border:"1px dashed rgba(0,0,0,0.1)","border-radius":"8px",margin:"8px","pointer-events":"none"}},null,-1)),(0,o.Lk)("div",Fe,(0,y.v_)(e.getSuitSymbol()),1),(0,o.Lk)("div",xe,[(0,o.RG)(e.$slots,"default",{},void 0,!0)]),e.$slots.footer?((0,o.uX)(),(0,o.CE)("div",Ye,[(0,o.RG)(e.$slots,"footer",{},void 0,!0)])):(0,o.Q3)("",!0)],2)}var Ue=(0,o.pM)({name:"GameCard",props:{title:{type:String,required:!0},subtitle:{type:String,default:""},cardType:{type:String,required:!0,validator:e=>Object.values(C).includes(e)},season:{type:String,default:null,validator:e=>null===e||Object.values(E).includes(e)}},computed:{cardTypeClass(){if(!this.cardType)return{};const e=this.cardType.toLowerCase(),t={[`game-card--${e.replace(/_/g,"-")}`]:!0};return this.cardType===C.SEASON&&this.season&&(t[this.season.toLowerCase()]=!0),t}},methods:{getSuitSymbol(){switch(this.cardType){case C.LANDSCAPE:return"♣";case C.ANIMAL_COMPANION:return"♥";case C.RESOURCE:return"♦";case C.CRAFTED_ITEM:return"♠";case C.SEASON:return"★";case C.CHARACTER:return"✦";default:return"•"}}},emits:["click"]});const Xe=(0,l.A)(Ue,[["render",We],["__scopeId","data-v-0ed5819c"]]);var je=Xe,qe=(0,o.pM)({name:"CompanionCard",components:{GameCard:je},props:{companionId:{type:String,required:!0},selected:{type:Boolean,default:!1},abilityUsed:{type:Boolean,default:!1}},emits:["select","use-ability","feed"],setup(e,{emit:t}){const a=T(),s=_(),n=b(),i=(0,v.KR)(!1),r=(0,v.KR)(""),c=(0,o.EW)((()=>a.getCompanionById(e.companionId))),l=(0,o.EW)((()=>me.getLoyalty(e.companionId))),d=(0,o.EW)((()=>{const e=l.value/5*100;return{width:`${e}%`,backgroundColor:g(l.value)}})),u=(0,o.EW)((()=>{const t=s.resources;return t.map((e=>a.getResourceById(e))).filter((t=>t&&me.isResourceSuitableForBonding(t.id,e.companionId)))})),h=(0,o.EW)((()=>u.value.length>0)),m=(0,o.EW)((()=>me.isCompanionWary(e.companionId))),p=e=>e.replace("_"," ").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" "),g=e=>e<=1?"#FF5252":e<=3?"#FFC107":"#4CAF50",f=()=>{t("select",e.companionId)},y=()=>{i.value=!0,r.value=u.value.length>0?u.value[0].id:""},L=()=>{i.value=!1,r.value=""},E=()=>{if(!r.value)return;const s=me.feedCompanion(e.companionId,r.value);if(s){const s=a.getResourceById(r.value);n.addToGameLog(`You fed your ${c.value?.name} with ${s?.name}.`,!0,"companion"),t("feed",e.companionId)}else n.addToGameLog("Failed to feed your companion.");L()},S=()=>{e.abilityUsed||m.value||t("use-ability",e.companionId)};return{companion:c,loyalty:l,loyaltyBarStyle:d,compatibleResources:u,canFeed:h,showFeedDialog:i,selectedResource:r,selectCompanion:f,openFeedDialog:y,closeFeedDialog:L,feedCompanion:E,useAbility:S,formatSeasonName:p,CardType:C,isCompanionWary:m}}});const Ve=(0,l.A)(qe,[["render",Oe],["__scopeId","data-v-46699847"]]);var ze=Ve,Ke=(0,o.pM)({name:"CompanionManagement",components:{CompanionCard:ze},emits:["close"],setup(e,{emit:t}){const a=T(),s=_(),n=b(),i=(0,o.EW)((()=>s.animalCompanions)),r=(0,o.EW)((()=>{const e=a.animalCompanions;return e.filter((e=>!i.value.includes(e.id)&&c(e)))})),c=e=>{const t=n.currentSeason;return e.affinitySeasons&&e.affinitySeasons.includes(t)},l=e=>e.replace("_"," ").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" "),d=(0,v.KR)([]),u=(0,v.KR)(""),h=(0,v.KR)(""),m=(0,v.KR)(!1),p=(0,v.KR)(""),g=e=>s.resources.filter((t=>me.isResourceSuitableForBonding(t,e))),f=e=>g(e).length>0,y=e=>s.resources.some((t=>me.isResourceSuitableForBonding(t,e))),C=(0,o.EW)((()=>{const e=a.getCompanionById(h.value);return e?e.name:""})),L=(0,o.EW)((()=>h.value?s.resources.filter((e=>me.isResourceSuitableForBonding(e,h.value))).map((e=>a.getResourceById(e))).filter((e=>void 0!==e)):[])),E=e=>{u.value=e},S=e=>{h.value=e},A=e=>{h.value=e;const t=g(e);t.length>0?(p.value=t[0],m.value=!0):n.addToGameLog("No compatible resources for bonding with this companion.")},R=()=>{m.value=!1,p.value=""},k=()=>{if(!h.value||!p.value)return void R();const e=me.bondWithCompanion(h.value,p.value);if(e){const e=a.getCompanionById(h.value);n.addToGameLog(`You've formed a bond with ${e?.name}!`,!0,"companion")}else n.addToGameLog("Failed to bond with the companion.");R()},I=e=>{if(d.value.includes(e))return;const t=s.useCompanionAbility(e);if(t){d.value.push(e);const t=a.getCompanionById(e);n.addToGameLog(`You used ${t?.name}'s ability: ${t?.ability.name}`,!0,"companion")}else n.addToGameLog("You cannot use this companion's ability right now.")};n.$subscribe(((e,t)=>{t.currentTurn>0&&(d.value=[])}));const w=e=>{console.log(`Open feed dialog for companion ${e}`)},N=()=>{t("close")};return{playerCompanions:i,availableCompanions:r,usedCompanionAbilities:d,selectedCompanion:u,showBondDialog:m,selectedResource:p,selectedCompanionName:C,compatibleResources:L,selectCompanion:E,selectAvailableCompanion:S,openBondDialog:A,closeBondDialog:R,bondWithCompanion:k,useCompanionAbility:I,hasCompatibleResources:f,hasResourcesForBonding:y,formatSeasonName:l,openFeedDialog:w,emitClose:N}}});const Je=(0,l.A)(Ke,[["render",ue],["__scopeId","data-v-0df5c584"]]);var Qe=Je;const Ze={class:"animal-companion-selection"},et={class:"animal-companion-selection__content"},tt={key:0,class:"empty-state"},at={key:1,class:"companion-grid"},st=["onClick"],nt={class:"companion-card__header"},ot={class:"season-affinity"},it={class:"companion-card__body"},rt={class:"companion-ability"},ct={class:"companion-card__footer"},lt=["onClick","disabled"],dt={key:0,class:"bond-dialog-overlay"},ut={class:"bond-dialog"},ht={class:"bond-dialog__header"},mt={class:"bond-dialog__content"},pt={class:"resource-list"},gt=["onClick"],ft={class:"resource-description"},yt={class:"bond-dialog__footer"},vt=["disabled"];function Ct(e,t,a,n,i,r){return(0,o.uX)(),(0,o.CE)("div",Ze,[t[5]||(t[5]=(0,o.Lk)("h2",{class:"animal-companion-selection__title"},"Available Companions",-1)),(0,o.Lk)("div",et,[0===e.availableCompanions.length?((0,o.uX)(),(0,o.CE)("div",tt,t[3]||(t[3]=[(0,o.Lk)("p",null,"No animal companions are available in this area.",-1),(0,o.Lk)("p",null,"Continue your journey to find potential companions.",-1)]))):((0,o.uX)(),(0,o.CE)("div",at,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.availableCompanions,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:"companion-card",onClick:a=>e.selectCompanion(t.id)},[(0,o.Lk)("div",nt,[(0,o.Lk)("h3",null,(0,y.v_)(t.name),1),(0,o.Lk)("div",ot,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.affinitySeasons,(t=>((0,o.uX)(),(0,o.CE)("span",{key:t,class:(0,y.C4)(["season-tag",t.toLowerCase()])},(0,y.v_)(e.formatSeasonName(t)),3)))),128))])]),(0,o.Lk)("div",it,[(0,o.Lk)("p",null,(0,y.v_)(t.description),1),(0,o.Lk)("div",rt,[(0,o.Lk)("h4",null,(0,y.v_)(t.ability.name),1),(0,o.Lk)("p",null,(0,y.v_)(t.ability.description),1)])]),(0,o.Lk)("div",ct,[(0,o.Lk)("button",{class:"btn btn--primary",onClick:(0,s.D$)((a=>e.bondWithCompanion(t.id)),["stop"]),disabled:!e.hasCompatibleResources(t.id)}," Bond ",8,lt)])],8,st)))),128))]))]),e.showBondDialog?((0,o.uX)(),(0,o.CE)("div",dt,[(0,o.Lk)("div",ut,[(0,o.Lk)("div",ht,[(0,o.Lk)("h3",null,"Bond with "+(0,y.v_)(e.selectedCompanionName),1),(0,o.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...t)=>e.closeBondDialog&&e.closeBondDialog(...t))},"×")]),(0,o.Lk)("div",mt,[t[4]||(t[4]=(0,o.Lk)("p",null,"Select a resource to form a bond:",-1)),(0,o.Lk)("div",pt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.compatibleResources,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:(0,y.C4)(["resource-item",{selected:e.selectedResource===t.id}]),onClick:a=>e.selectedResource=t.id},[(0,o.Lk)("span",null,(0,y.v_)(t.name),1),(0,o.Lk)("p",ft,(0,y.v_)(t.description),1)],10,gt)))),128))])]),(0,o.Lk)("div",yt,[(0,o.Lk)("button",{class:"btn btn--primary",onClick:t[1]||(t[1]=(...t)=>e.confirmBond&&e.confirmBond(...t)),disabled:!e.selectedResource}," Bond ",8,vt),(0,o.Lk)("button",{class:"btn btn--secondary",onClick:t[2]||(t[2]=(...t)=>e.closeBondDialog&&e.closeBondDialog(...t))}," Cancel ")])])])):(0,o.Q3)("",!0)])}var Lt=(0,o.pM)({name:"AnimalCompanionSelection",emits:["select-companion"],setup(e,{emit:t}){const a=T(),s=_(),n=b(),i=e=>e.replace("_"," ").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase())).join(" "),r=(0,o.EW)((()=>{const e=n.currentLandscapeId;if(!e)return[];const t={sacred_oak_grove:["wolf","deer","bear","boar"],faerie_knoll:["fox","hare"],moonlit_loch:["salmon","owl"],whispering_heath:["raven"],wild_horse_plain:["horse"]};if(!t[e])return[];const o=t[e];return a.animalCompanions.filter((e=>{if(s.animalCompanions.includes(e.id))return!1;const t=e.id.split("_")[0].toLowerCase();return o.includes(t)}))})),c=(0,v.KR)(!1),l=(0,v.KR)(""),d=(0,v.KR)("");(0,o.sV)((()=>{const e=me.selectRandomCompanion();e&&(l.value=e,m(e)&&g(e))}));const u=(0,o.EW)((()=>{const e=a.getCompanionById(l.value);return e?e.name:""})),h=(0,o.EW)((()=>l.value?s.resources.filter((e=>me.isResourceSuitableForBonding(e,l.value))).map((e=>a.getResourceById(e))).filter((e=>void 0!==e)):[])),m=e=>s.resources.some((t=>me.isResourceSuitableForBonding(t,e))),p=e=>{t("select-companion",e)},g=e=>{l.value=e;const t=s.resources.filter((t=>me.isResourceSuitableForBonding(t,e)));t.length>0?(d.value=t[0],c.value=!0):n.addToGameLog("No compatible resources available for bonding with this companion.")},f=()=>{c.value=!1,d.value=""},y=()=>{if(!l.value||!d.value)return void f();const e=me.bondWithCompanion(l.value,d.value);if(e){const e=a.getCompanionById(l.value);n.addToGameLog(`You've bonded with ${e?.name}!`,!0,"companion"),p(l.value)}else n.addToGameLog("Failed to bond with the companion.");f()};return{formatSeasonName:i,availableCompanions:r,showBondDialog:c,selectedCompanion:l,selectedResource:d,selectedCompanionName:u,compatibleResources:h,hasCompatibleResources:m,selectCompanion:p,bondWithCompanion:g,closeBondDialog:f,confirmBond:y}}});const Et=(0,l.A)(Lt,[["render",Ct],["__scopeId","data-v-26ff0409"]]);var Tt=Et;const St={class:"player-dashboard",style:{border:"2px solid lightblue",position:"relative"}},bt={class:"player-info"},At={key:0},Rt={class:"player-stats"},_t={class:"stat"},kt={class:"stat-value"},It={class:"stat"},wt={class:"stat-value"},Nt={class:"resources-section"},Ot={key:0,class:"empty-state"},Gt={key:1,class:"resource-list"};function Mt(e,t,a,s,n,i){return(0,o.uX)(),(0,o.CE)("div",St,[t[3]||(t[3]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"PlayerDashboard",-1)),(0,o.Lk)("div",bt,[e.character?((0,o.uX)(),(0,o.CE)("h2",At,(0,y.v_)(e.character.name),1)):(0,o.Q3)("",!0),(0,o.Lk)("div",Rt,[(0,o.Lk)("div",_t,[t[0]||(t[0]=(0,o.Lk)("span",{class:"stat-label"},"Health:",-1)),(0,o.Lk)("span",kt,(0,y.v_)(e.playerStore.health)+"/"+(0,y.v_)(e.playerStore.maxHealth),1)]),(0,o.Lk)("div",It,[t[1]||(t[1]=(0,o.Lk)("span",{class:"stat-label"},"Experience:",-1)),(0,o.Lk)("span",wt,(0,y.v_)(e.playerStore.experience),1)])])]),(0,o.Lk)("div",Nt,[t[2]||(t[2]=(0,o.Lk)("h3",null,"Resources",-1)),0===e.playerStore.resources.length?((0,o.uX)(),(0,o.CE)("div",Ot,"No resources collected yet")):((0,o.uX)(),(0,o.CE)("ul",Gt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.playerStore.resources,(t=>((0,o.uX)(),(0,o.CE)("li",{key:t,class:"resource-list__item"},(0,y.v_)(e.getResourceName(t)),1)))),128))]))])])}var Ht=(0,o.pM)({name:"PlayerDashboard",setup(){const e=_(),t=T(),a=(0,o.EW)((()=>e.characterId?t.getCharacterById(e.characterId):null)),s=e=>{const a=t.getResourceById(e);return a?a.name:"Unknown Resource"};return{playerStore:e,character:a,getResourceName:s}}});const Dt=(0,l.A)(Ht,[["render",Mt],["__scopeId","data-v-79cdc1e7"]]);var Pt=Dt;const $t={class:"crafting-station",style:{border:"2px solid lightblue",position:"relative"}},Bt={key:0,class:"crafting-station__inactive"},Ft={key:1,class:"crafting-station__active"},xt={class:"crafting-station__recipes"},Yt={key:0,class:"empty-state"},Wt={key:1,class:"recipe-list"},Ut=["onClick"],Xt={class:"recipe-complexity"},jt={class:"recipe-resources"},qt={key:0,class:"crafting-station__details"},Vt={class:"item-ability mt-3"},zt={class:"ability-description"},Kt={key:0,class:"item-drawback mt-3"},Jt={class:"drawback-description"},Qt={class:"item-resources mt-3"},Zt={class:"resource-requirements"},ea={class:"resource-status"},ta={class:"crafting-actions mt-4"},aa=["disabled"],sa={key:1,class:"crafting-station__placeholder"};function na(e,t,a,s,n,i){return(0,o.uX)(),(0,o.CE)("div",$t,[t[8]||(t[8]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"CraftingStation",-1)),t[9]||(t[9]=(0,o.Lk)("h3",{class:"crafting-station__title"},"Crafting Station",-1)),e.currentPhase!==e.GamePhase.CRAFTING?((0,o.uX)(),(0,o.CE)("div",Bt,t[2]||(t[2]=[(0,o.Lk)("p",null,"Crafting is not available during the current phase.",-1)]))):((0,o.uX)(),(0,o.CE)("div",Ft,[(0,o.Lk)("div",xt,[t[4]||(t[4]=(0,o.Lk)("h4",null,"Available Recipes",-1)),0===e.availableRecipes.length?((0,o.uX)(),(0,o.CE)("div",Yt," You don't have enough resources to craft any items. ")):((0,o.uX)(),(0,o.CE)("div",Wt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.availableRecipes,(a=>((0,o.uX)(),(0,o.CE)("div",{key:a.id,class:(0,y.C4)(["recipe-list__item",{selected:e.selectedRecipe?.id===a.id}]),onClick:t=>e.selectRecipe(a)},[(0,o.Lk)("h5",null,(0,y.v_)(a.name),1),(0,o.Lk)("div",Xt,"Complexity: "+(0,y.v_)(a.complexity),1),(0,o.Lk)("div",jt,[t[3]||(t[3]=(0,o.Lk)("div",null,"Required Resources:",-1)),(0,o.Lk)("ul",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(a.requiredResources,(t=>((0,o.uX)(),(0,o.CE)("li",{key:t},[(0,o.eW)((0,y.v_)(e.getResourceName(t))+" ",1),(0,o.Lk)("span",{class:(0,y.C4)(["resource-status",{available:e.hasResource(t),missing:!e.hasResource(t)}])},(0,y.v_)(e.hasResource(t)?"✓":"✗"),3)])))),128))])])],10,Ut)))),128))]))]),e.selectedRecipe?((0,o.uX)(),(0,o.CE)("div",qt,[(0,o.Lk)("h4",null,(0,y.v_)(e.selectedRecipe.name),1),(0,o.Lk)("p",null,(0,y.v_)(e.selectedRecipe.description),1),(0,o.Lk)("div",Vt,[(0,o.Lk)("h5",null,"Ability: "+(0,y.v_)(e.selectedRecipe.ability.name),1),(0,o.Lk)("p",zt,(0,y.v_)(e.selectedRecipe.ability.description),1)]),e.selectedRecipe.drawback?((0,o.uX)(),(0,o.CE)("div",Kt,[t[5]||(t[5]=(0,o.Lk)("h5",null,"Drawback",-1)),(0,o.Lk)("p",Jt,(0,y.v_)(e.selectedRecipe.drawback.description),1)])):(0,o.Q3)("",!0),(0,o.Lk)("div",Qt,[t[6]||(t[6]=(0,o.Lk)("h5",null,"Required Resources",-1)),(0,o.Lk)("ul",Zt,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.selectedRecipe.requiredResources,(t=>((0,o.uX)(),(0,o.CE)("li",{key:t,class:(0,y.C4)({available:e.hasResource(t),missing:!e.hasResource(t)})},[(0,o.eW)((0,y.v_)(e.getResourceName(t))+" ",1),(0,o.Lk)("span",ea,(0,y.v_)(e.hasResource(t)?"✓":"✗"),1)],2)))),128))])]),(0,o.Lk)("div",ta,[(0,o.Lk)("button",{class:"btn btn--primary",onClick:t[0]||(t[0]=(...t)=>e.craftItem&&e.craftItem(...t)),disabled:!e.canCraftSelectedRecipe}," Craft Item ",8,aa),(0,o.Lk)("button",{class:"btn btn--secondary ml-2",onClick:t[1]||(t[1]=(...t)=>e.cancelCrafting&&e.cancelCrafting(...t))}," Cancel ")])])):((0,o.uX)(),(0,o.CE)("div",sa,t[7]||(t[7]=[(0,o.Lk)("p",null,"Select a recipe to view details and craft an item.",-1)])))]))])}var oa,ia,ra,ca=a(1114);a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);(function(e){e["RESOURCE_LOSS"]="RESOURCE_LOSS",e["HEALTH_LOSS"]="HEALTH_LOSS",e["CHALLENGE_DIFFICULTY"]="CHALLENGE_DIFFICULTY",e["COMPANION_EFFECT"]="COMPANION_EFFECT",e["LANDSCAPE_EFFECT"]="LANDSCAPE_EFFECT",e["SEASONAL_SHIFT"]="SEASONAL_SHIFT"})(oa||(oa={})),function(e){e["MINOR"]="MINOR",e["MODERATE"]="MODERATE",e["MAJOR"]="MAJOR"}(ia||(ia={})),function(e){e["MIST_WRAITH"]="MIST_WRAITH",e["BARROW_WIGHT"]="BARROW_WIGHT",e["FAERIE_ENTICEMENT"]="FAERIE_ENTICEMENT",e["WILD_HUNT"]="WILD_HUNT",e["ANCIENT_GUARDIAN"]="ANCIENT_GUARDIAN",e["BOUNDARY_COLLAPSE"]="BOUNDARY_COLLAPSE",e["SPIRIT_POSSESSION"]="SPIRIT_POSSESSION",e["COSMIC_IMBALANCE"]="COSMIC_IMBALANCE"}(ra||(ra={}));class la{constructor(){(0,ca.A)(this,"gameStore",b()),(0,ca.A)(this,"playerStore",_()),(0,ca.A)(this,"cardStore",T()),(0,ca.A)(this,"threatReductionThisTurn",0),(0,ca.A)(this,"MAX_THREAT_REDUCTION_PER_TURN",3),(0,ca.A)(this,"SACRED_SITES",{MOONLIT_LOCH:"moonlit_loch",DRUIDS_SANCTUARY:"druids_sanctuary"}),(0,ca.A)(this,"THREAT_RESOURCES",{SACRED_WATER:"sacred_water",ROWAN_WOOD:"rowan_wood"}),(0,ca.A)(this,"hasPerformedSeasonalRitual",!1),(0,ca.A)(this,"threatEvents",[{id:"threat_event_1",name:"Unsettling Whispers",description:"Strange whispers echo through the landscape, causing unease.",type:ia.MINOR,manifestation:oa.CHALLENGE_DIFFICULTY,strength:1,duration:2},{id:"threat_event_2",name:"Sudden Chill",description:"A bone-deep chill sets in, making it harder to perform tasks.",type:ia.MINOR,manifestation:oa.HEALTH_LOSS,strength:1,duration:1},{id:"threat_event_3",name:"Misplaced Supplies",description:"Some of your resources have mysteriously gone missing.",type:ia.MINOR,manifestation:oa.RESOURCE_LOSS,strength:1,duration:1},{id:"threat_event_4",name:"Otherworldly Fog",description:"A thick, unnatural fog descends, obscuring paths and hiding dangers.",type:ia.MODERATE,manifestation:oa.LANDSCAPE_EFFECT,strength:2,duration:3},{id:"threat_event_5",name:"Animal Unrest",description:"Animals in the area become agitated and difficult to approach.",type:ia.MODERATE,manifestation:oa.COMPANION_EFFECT,strength:2,duration:2},{id:"threat_event_6",name:"Weakening Boundaries",description:"The veil between worlds thins, allowing strange energies to seep through.",type:ia.MODERATE,manifestation:oa.CHALLENGE_DIFFICULTY,strength:2,duration:3},{id:"threat_event_7",name:"Seasonal Disruption",description:"The natural cycle of seasons is disrupted, causing environmental chaos.",type:ia.MAJOR,manifestation:oa.SEASONAL_SHIFT,strength:3,duration:4},{id:"threat_event_8",name:"Otherworldly Manifestation",description:"A powerful entity from beyond manifests, draining life force from all it encounters.",type:ia.MAJOR,manifestation:oa.HEALTH_LOSS,strength:3,duration:3},{id:"threat_event_9",name:"Resource Blight",description:"A mysterious blight affects resources in the area, causing them to wither or spoil.",type:ia.MAJOR,manifestation:oa.RESOURCE_LOSS,strength:3,duration:4}]),(0,ca.A)(this,"otherworldlyManifestations",[{id:"manifestation_1",name:"Mist Wraith",description:"Obscures path, requires Amber Shards to banish",type:ia.MAJOR,manifestation:oa.LANDSCAPE_EFFECT,strength:2,duration:3,counterResource:"amber_shards"},{id:"manifestation_2",name:"Barrow Wight",description:"Drains health each turn, must outrun or confront",type:ia.MAJOR,manifestation:oa.HEALTH_LOSS,strength:2,duration:3,requiresChallenge:!0},{id:"manifestation_3",name:"Faerie Enticement",description:"Attempts to lead you astray, requires willpower challenge",type:ia.MAJOR,manifestation:oa.CHALLENGE_DIFFICULTY,strength:2,duration:2,challengeType:"mental"},{id:"manifestation_4",name:"Wild Hunt",description:"Pursues you for 1d4 turns, must hide or join the hunt",type:ia.MAJOR,manifestation:oa.CHALLENGE_DIFFICULTY,strength:3,duration:Math.floor(4*Math.random())+1,challengeType:"physical"},{id:"manifestation_5",name:"Ancient Guardian",description:"Blocks path, requires specific offering or riddling",type:ia.MAJOR,manifestation:oa.LANDSCAPE_EFFECT,strength:3,duration:2,requiresOffering:!0},{id:"manifestation_6",name:"Boundary Collapse",description:"Seasons blur, unpredictable effects each turn",type:ia.MAJOR,manifestation:oa.SEASONAL_SHIFT,strength:3,duration:4},{id:"manifestation_7",name:"Spirit Possession",description:"Animal Companion turns against you",type:ia.MAJOR,manifestation:oa.COMPANION_EFFECT,strength:3,duration:3},{id:"manifestation_8",name:"Cosmic Imbalance",description:"All challenges +2 difficulty until balance restored",type:ia.MAJOR,manifestation:oa.CHALLENGE_DIFFICULTY,strength:2,duration:4}])}addThreatTokens(e){return this.gameStore.addThreatTokens(e)}removeThreatTokens(e){const t=this.MAX_THREAT_REDUCTION_PER_TURN-this.threatReductionThisTurn;if(t<=0)return this.gameStore.addToGameLog("Maximum threat reduction reached for this turn.",!0),this.gameStore.threatTokens;const a=Math.min(e,t);return this.threatReductionThisTurn+=a,a<e&&this.gameStore.addToGameLog(`Reduced ${a} threat tokens (limit reached for this turn).`,!0),this.gameStore.removeThreatTokens(a)}resetThreatReductionTracker(){this.threatReductionThisTurn=0}getThreatLevel(){return Math.floor(this.gameStore.threatTokens/3)}hasThreatPrevention(){return this.playerStore.hasEffect("threat_prevention")}generateRandomThreatEvent(){const e=this.getThreatLevel();if(0===e)return null;let t=[];if(t=1===e?this.threatEvents.filter((e=>e.type===ia.MINOR)):2===e?this.threatEvents.filter((e=>e.type===ia.MINOR||e.type===ia.MODERATE)):this.threatEvents,t.length>0){const e=Math.floor(Math.random()*t.length);return t[e]}return null}applyThreatEvent(e){if(this.hasThreatPrevention())this.gameStore.addToGameLog(`${e.name} was prevented by your protective effects!`,!0);else switch(this.gameStore.addToGameLog(`Threat manifests: ${e.name} - ${e.description}`,!0),e.manifestation){case oa.HEALTH_LOSS:this.playerStore.takeDamage(e.strength),this.gameStore.addToGameLog(`You lose ${e.strength} health from the threat.`);break;case oa.RESOURCE_LOSS:this.playerStore.loseRandomResources(e.strength),this.gameStore.addToGameLog(`You lose ${e.strength} random resources from the threat.`);break;case oa.CHALLENGE_DIFFICULTY:this.gameStore.addTempEffect("threat_challenge_difficulty","Increased Challenge Difficulty",`Challenges are ${e.strength} points more difficult due to threat.`,e.strength,e.duration);break;case oa.COMPANION_EFFECT:this.gameStore.addTempEffect("threat_companion_effect","Companion Unrest","Animal companions are less effective due to threat.",e.strength,e.duration);break;case oa.LANDSCAPE_EFFECT:this.gameStore.addTempEffect("threat_landscape_effect","Landscape Disruption","Resource gathering is reduced due to threat.",e.strength,e.duration);break;case oa.SEASONAL_SHIFT:this.gameStore.addTempEffect("threat_seasonal_shift","Seasonal Disruption","Seasonal benefits are reduced due to threat.",e.strength,e.duration),e.type===ia.MAJOR&&this.gameStore.advanceSeason();break}}manifestThreat(){if(this.hasThreatPrevention())return this.gameStore.addToGameLog("Your protective effects prevented a threat manifestation!",!0),null;const e=this.generateRandomThreatEvent();return e?(this.applyThreatEvent(e),e):null}shouldManifestThreat(){const e=this.getThreatLevel();if(0===e)return!1;const t=.15*e;return Math.random()<t}addThreatPreventionEffect(e,t=1){const a={id:"threat_prevention",name:"Threat Prevention",description:"Prevents threat manifestations from affecting you.",magnitude:t,duration:e,type:"protection",target:"player"};this.playerStore.addEffect(a),this.gameStore.addToGameLog(`You are now protected from threats for ${e} turns.`,!0)}processThreatEffects(){this.resetThreatReductionTracker(),this.shouldManifestThreat()&&this.manifestThreat(),this.gameStore.threatTokens>=10&&this.rollForOtherworldlyManifestation()}useSacredSiteForThreatReduction(e){if(e===this.SACRED_SITES.MOONLIT_LOCH){const e=Math.floor(3*Math.random())+1;return this.gameStore.addToGameLog(`You performed a purification ritual at the Moonlit Loch, reducing threat by ${e}.`,!0),this.removeThreatTokens(e)}return e===this.SACRED_SITES.DRUIDS_SANCTUARY?(this.gameStore.addToGameLog("You meditated at the Druid's Sanctuary, reducing threat by 2.",!0),this.removeThreatTokens(2)):0}useResourceForThreatReduction(e){const t=_();if(e===this.THREAT_RESOURCES.SACRED_WATER){if(this.removeThreatTokens(1)>0)return t.removeResource(e),this.gameStore.addToGameLog("You used Sacred Water to purify and reduce threat by 1.",!0),!0}else if(e===this.THREAT_RESOURCES.ROWAN_WOOD)return t.removeResource(e),this.gameStore.addTempEffect("threat_prevention_rowan","Rowan Protection","Protected from threat accumulation by Rowan Wood.",1,1),this.gameStore.addToGameLog("You used Rowan Wood to ward against the next threat accumulation.",!0),!0;return!1}performSeasonalPurificationRitual(){const e=this.gameStore,t=e.currentSeason;if(this.hasPerformedSeasonalRitual)return e.addToGameLog("You have already performed a purification ritual this season.",!0),0;let a=1,s="";switch(t){case E.IMBOLC:s="Imbolc Purification",a=3;break;case E.BELTANE:s="Spring Renewal Ritual",a=2;break;case E.LUGHNASADH:s="Summer Solstice Ceremony",a=3;break;case E.SAMHAIN:s="Autumn Harvest Offering",a=2;break;case E.WINTERS_DEPTH:s="Winter Solstice Vigil",a=1;break}return this.hasPerformedSeasonalRitual=!0,e.addToGameLog(`You performed the ${s}, reducing threat by ${a}.`,!0),this.removeThreatTokens(a)}resetSeasonalRitualTracker(){this.hasPerformedSeasonalRitual=!1}rollForOtherworldlyManifestation(){if(this.gameStore.threatTokens<10)return null;const e=Math.floor(8*Math.random())+1,t=this.otherworldlyManifestations[e-1];return this.gameStore.addToGameLog(`Otherworldly Manifestation: ${t.name} - ${t.description}`,!0),this.applyThreatEvent(t),t}isSacredSite(e){return e===this.SACRED_SITES.MOONLIT_LOCH||e===this.SACRED_SITES.DRUIDS_SANCTUARY}isResourceUsefulForThreat(e){return e===this.THREAT_RESOURCES.SACRED_WATER||e===this.THREAT_RESOURCES.ROWAN_WOOD}getThreatForCraftedItem(e){const t=this.cardStore.getCraftedItemById(e);if(!t)return 0;if(t.complexity){const e="number"===typeof t.complexity?t.complexity:this.getComplexityValue(t.complexity);if(e>=4)return 3;if(e>=3)return 2;if(e>=2)return 1}return 0}getComplexityValue(e){switch(e){case"LEGENDARY":return 4;case"ADVANCED":return 3;case"COMPLEX":return 2;case"SIMPLE":default:return 1}}addThreatForSeasonalCrossing(){return this.addThreatTokens(2)}addThreatForSacredSiteDisrespect(e,t=1){if(this.isSacredSite(e)){const e=Math.max(1,Math.min(3,t));return this.gameStore.addToGameLog(`Your actions have disrespected a sacred site, increasing threat by ${e}.`,!0),this.addThreatTokens(e)}return 0}handleSeasonChange(e,t){this.resetSeasonalRitualTracker();const a=this.playerStore;let s=!1;t===E.WINTERS_DEPTH?s=a.resources.some((e=>["woven_reeds","forge_cinders"].includes(e))):t===E.IMBOLC?s=a.resources.some((e=>["rowan_wood","silver_mistletoe"].includes(e))):t===E.BELTANE?s=a.resources.some((e=>["oak_galls","amber_shards"].includes(e))):t===E.LUGHNASADH?s=a.resources.some((e=>["sacred_water","horse_hair"].includes(e))):t===E.SAMHAIN&&(s=a.resources.some((e=>["barrow_dust","ogham_sticks"].includes(e)))),s?this.gameStore.addToGameLog(`Your preparations have eased the transition to ${t}.`,!0):(this.addThreatForSeasonalCrossing(),this.gameStore.addToGameLog(`You were unprepared for the transition to ${t}, increasing threat by 2.`,!0))}processEndOfTurn(){this.processThreatEffects();const e=this.gameStore.currentLandscapeId;this.isSacredSite(e)&&this.gameStore.addToGameLog(`You are at a sacred site (${e}). You may perform a ritual to reduce threat.`,!1)}processResourceUse(e){return!!this.isResourceUsefulForThreat(e)&&this.useResourceForThreatReduction(e)}}const da={SIMPLE:1,COMPLEX:2,ADVANCED:3,LEGENDARY:4},ua=e=>{if("number"===typeof e)return e;switch(e.toLowerCase()){case"simple":return da.SIMPLE;case"complex":return da.COMPLEX;case"advanced":return da.ADVANCED;case"legendary":return da.LEGENDARY;default:return da.SIMPLE}};class ha{constructor(){(0,ca.A)(this,"gameStore",b()),(0,ca.A)(this,"playerStore",_()),(0,ca.A)(this,"cardStore",T()),(0,ca.A)(this,"threatService",new la)}canCraftItem(e){const t=_(),a=T(),s=b(),n=a.getCraftedItemById(e);if(!n)return{canCraft:!1,missingResources:[],landscapeSupported:!1,playerSkill:!1};if(t.craftedItems.includes(e))return{canCraft:!1,missingResources:[],landscapeSupported:!1,playerSkill:!1};const o=[];for(const c of n.requiredResources)t.resources.includes(c)||o.push(c);const i=this.isComplexitySupportedByLandscape(ua(n.complexity),s.currentLandscapeId),r=this.playerHasSkillForComplexity(ua(n.complexity));return{canCraft:0===o.length&&i&&r,missingResources:o,landscapeSupported:i,playerSkill:r}}isComplexitySupportedByLandscape(e,t){const a=T(),s=a.getLandscapeById(t);return!!s&&(!(!s.hasCraftingFacilities&&e>da.SIMPLE)&&(!!(s.hasCraftingFacilities&&e<=da.COMPLEX)||(s.specialCraftingCapabilities?e<=s.specialCraftingCapabilities:e===da.SIMPLE)))}playerHasSkillForComplexity(e){const t=_(),a=t.craftedItemCount;return e===da.SIMPLE||(e===da.COMPLEX?a>=1:e===da.ADVANCED?a>=3:e===da.LEGENDARY&&a>=5)}craftItem(e){const{canCraft:t,missingResources:a,landscapeSupported:s,playerSkill:n}=this.canCraftItem(e);if(!t)return a.length>0?this.gameStore.addToGameLog(`Cannot craft item: missing resources - ${a.join(", ")}`,!0):s?n?this.gameStore.addToGameLog("Cannot craft item: unknown reason",!0):this.gameStore.addToGameLog("Cannot craft item: insufficient crafting experience",!0):this.gameStore.addToGameLog("Cannot craft item: current landscape does not support this complexity of crafting",!0),!1;const o=this.cardStore.getCraftedItemById(e);if(!o)return this.gameStore.addToGameLog(`Cannot craft item: item with ID ${e} not found`,!0),!1;const i=[];for(const c of o.requiredResources)this.cardStore.getResourceById(c)||i.push(c);if(i.length>0)return this.gameStore.addToGameLog(`Crafting failed: invalid resource references - ${i.join(", ")}`,!0),!1;for(const c of o.requiredResources)this.playerStore.removeResource(c);this.playerStore.addCraftedItem(e),this.playerStore.craftedItems.includes(e)||this.playerStore.uniqueCraftedItemsCount++,o.isLegendary&&(this.playerStore.hasCraftedLegendaryItem=!0);const r=this.threatService.getThreatForCraftedItem(e);return r>0&&(this.threatService.addThreatTokens(r),this.gameStore.addToGameLog(`Crafting this powerful item has increased threat by ${r}.`,!0)),this.gameStore.addToGameLog(`Successfully crafted ${o.name}!`,!0),!0}calculateCraftingDifficulty(e){const t=T(),a=b(),s=t.getCraftedItemById(e);if(!s)return 0;const n=ua(s.complexity),o="number"===typeof s["difficulty"]?s["difficulty"]:3;let i=o*n;const r=this.getLocationCraftingBonus(e,a.currentLandscapeId);i-=2*r;const c=this.getSeasonalCraftingModifier(a.currentSeason);i+=c;const l=Math.floor(a.threatTokens/3);i+=l;const d=_(),u=Math.floor(d.craftedItemCount/2);return i-=u,Math.max(1,i)}getLocationCraftingBonus(e,t){const a=T(),s=a.getCraftedItemById(e),n=a.getLandscapeById(t);return s&&n?n.hasCraftingFacilities?1:n.craftingBonuses&&s.type&&n.craftingBonuses[s.type]?n.craftingBonuses[s.type]:n.specialCraftingCapabilities&&ua(s.complexity)<=n.specialCraftingCapabilities?2:0:0}getSeasonalCraftingModifier(e){const t={SAMHAIN:0,WINTERS_DEPTH:1,IMBOLC:0,BELTANE:-1,LUGHNASADH:-1};return t[e]||0}getRecipeSuggestions(){const e=T(),t=e.getAllCraftedItems();return t.filter((e=>e.requiredResources&&e.requiredResources.length>0)).map((e=>e.id))}getRecipeSuggestionsByComplexity(e){const t=T(),a=t.getAllCraftedItems();return a.filter((t=>t.requiredResources&&t.requiredResources.length>0&&t.requiredResources.length<=e)).map((e=>e.id))}getCraftingRequirements(e){const t=T(),a=b(),s=(_(),t.getCraftedItemById(e));if(!s)return null;const{missingResources:n,landscapeSupported:o,playerSkill:i}=this.canCraftItem(e),r=this.calculateCraftingDifficulty(e),c=this.getLocationCraftingBonus(e,a.currentLandscapeId),l=this.getSeasonalCraftingModifier(a.currentSeason);return{item:s,requiredResources:s.requiredResources,missingResources:n,landscapeSupported:o,playerSkill:i,difficulty:r,locationBonus:c,seasonalModifier:l}}applyItemEffect(e){const t=_(),a=T(),s=a.getCraftedItemById(e);if(s&&s.ability&&"object"===typeof s.ability){if("healing"===s.ability.type)t.healHealth(2);else if("protection"===s.ability.type){const t=b();t.addTempEffect(`${e}_protection`,`${s.name} Protection`,s.ability.description||"",2,3)}if(s.drawback){const e=b();e.addThreatTokens(1)}}}checkCraftingVictoryConditions(){const e=_(),t=T(),a=e.craftedItems.some((e=>{const a=t.getCraftedItemById(e);return a&&a.isLegendary}));a&&(e.hasCraftedLegendaryItem=!0);const s=new Set(e.craftedItems.map((e=>{const a=t.getCraftedItemById(e);return a?a.type:null})).filter(Boolean));e.uniqueCraftedItemsCount=s.size}}var ma=(0,o.pM)({name:"CraftingStation",setup(){const e=T(),t=_(),a=b(),s=(0,v.KR)(null),n=(0,v.KR)(null);(0,o.sV)((()=>{try{s.value=new ha,console.log("CraftingStation: CraftingService initialized successfully")}catch(e){console.error("CraftingStation: Error initializing CraftingService:",e)}}));const i=(0,o.EW)((()=>a.currentPhase)),r=(0,o.EW)((()=>t.resources)),c=(0,o.EW)((()=>e.craftedItems.filter((e=>e.requiredResources.some((e=>r.value.includes(e))))))),l=(0,o.EW)((()=>{if(!n.value)return!1;if(s.value){const e=s.value.canCraftItem(n.value.id);return e.canCraft}return n.value.requiredResources.every((e=>r.value.includes(e)))})),d=t=>{const a=e.getResourceById(t);return a?a.name:"Unknown Resource"},u=e=>r.value.includes(e),h=e=>{n.value=e},m=()=>{if(n.value&&l.value){if(s.value){const e=s.value.craftItem(n.value.id);if(!e)return void console.error("Failed to craft item")}else n.value.requiredResources.forEach((e=>{t.removeResource(e)}));t.addCraftedItem(n.value.id),t.gainExperience(1),a.addToGameLog(`You crafted a ${n.value.name}!`),n.value=null,a.advancePhase()}},p=()=>{n.value=null,a.advancePhase()};return{currentPhase:i,availableRecipes:c,selectedRecipe:n,canCraftSelectedRecipe:l,getResourceName:d,hasResource:u,selectRecipe:h,craftItem:m,cancelCrafting:p,GamePhase:S}}});const pa=(0,l.A)(ma,[["render",na],["__scopeId","data-v-05833e9e"]]);var ga=pa;const fa={class:"game-log",style:{border:"2px solid lightblue",position:"relative"}},ya={class:"game-log__entries",ref:"logContainer"},va={class:"game-log__timestamp"},Ca={class:"game-log__message"},La={key:0,class:"game-log__empty"};function Ea(e,t,a,s,n,i){return(0,o.uX)(),(0,o.CE)("div",fa,[t[0]||(t[0]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"GameLog",-1)),t[1]||(t[1]=(0,o.Lk)("h3",{class:"game-log__title"},"Journey Log",-1)),(0,o.Lk)("div",ya,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.gameLog,((t,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:(0,y.C4)(["game-log__entry",{"game-log__entry--highlight":t.highlight}])},[(0,o.Lk)("span",va,(0,y.v_)(e.formatTimestamp(t.timestamp)),1),(0,o.Lk)("span",Ca,(0,y.v_)(t.message),1)],2)))),128)),0===e.gameLog.length?((0,o.uX)(),(0,o.CE)("div",La," Your journey has just begun. Events will be recorded here. ")):(0,o.Q3)("",!0)],512)])}var Ta=(0,o.pM)({name:"GameLog",setup(){const e=b(),t=(0,v.KR)(null),a=(0,o.EW)((()=>e.gameLog)),s=e=>{const t=new Date(e),a=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0"),n=t.getSeconds().toString().padStart(2,"0");return`${a}:${s}:${n}`};return(0,o.wB)((()=>a.value.length),(()=>{(0,o.dY)((()=>{t.value&&(t.value.scrollTop=t.value.scrollHeight)}))})),{gameLog:a,logContainer:t,formatTimestamp:s}}});const Sa=(0,l.A)(Ta,[["render",Ea],["__scopeId","data-v-5a1c79ec"]]);var ba=Sa;const Aa={class:"game-map",style:{border:"2px solid lightblue",position:"relative"}},Ra={class:"game-map__content"},_a={class:"map-container"},ka={class:"map-grid"},Ia={class:"location-marker"},wa={class:"location-name"};function Na(e,t,a,s,n,i){return(0,o.uX)(),(0,o.CE)("div",Aa,[t[1]||(t[1]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"GameMap",-1)),t[2]||(t[2]=(0,o.Lk)("h3",{class:"game-map__title"},"Journey Map",-1)),(0,o.Lk)("div",Ra,[(0,o.Lk)("div",_a,[(0,o.Lk)("div",ka,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(e.journeyLocations,((t,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:(0,y.C4)(["map-location",{"map-location--active":a===e.currentLocationIndex,"map-location--visited":a<e.currentLocationIndex}])},[(0,o.Lk)("div",Ia,(0,y.v_)(a+1),1),(0,o.Lk)("div",wa,(0,y.v_)(t.name),1)],2)))),128))]),t[0]||(t[0]=(0,o.Lk)("div",{class:"map-path"},null,-1))])])])}var Oa=(0,o.pM)({name:"GameMap",setup(){const e=b(),t=(0,v.KR)([{name:"Forest Edge",type:"forest"},{name:"River Crossing",type:"river"},{name:"Mountain Pass",type:"mountain"},{name:"Ancient Ruins",type:"ruins"},{name:"Valley Settlement",type:"settlement"}]),a=(0,o.EW)((()=>e.journeyProgress||0));return{journeyLocations:t,currentLocationIndex:a}}});const Ga=(0,l.A)(Oa,[["render",Na],["__scopeId","data-v-11ad1a66"]]);var Ma=Ga;const Ha={class:"game-board",style:{border:"2px solid lightblue",position:"relative"}},Da={class:"game-header"},Pa={class:"game-content"},$a={class:"season-section"},Ba={class:"season-card-container"},Fa={class:"character-section"},xa={class:"character-card-container"},Ya={key:0},Wa={key:0},Ua={key:0,class:"landscape-section"},Xa={class:"landscape-card-container"},ja={key:0},qa={class:"phase-content"},Va={key:0},za={class:"phase-description"},Ka={key:1},Ja={class:"challenge-card-container"},Qa={key:0},Za={key:0},es={key:1},ts={key:2},as={class:"challenge-details mt-4"},ss={key:2},ns={key:3},os={class:"resource-actions mt-4"},is=["disabled"],rs={key:0,class:"resource-warning mt-2"},cs={key:4},ls={key:5},ds={key:0},us={key:1},hs={key:6},ms={class:"journey-actions mt-4"},ps={key:7},gs={class:"season-assessment-content"},fs={class:"season-actions mt-4"},ys={class:"game-log"};var vs=(0,o.pM)({__name:"GameBoardView",setup(e){const t=(0,f.rd)(),a=_(),s=b(),n=T(),i=(0,v.KR)(null),r=(0,v.KR)(null),c=(0,v.KR)(null);(0,o.sV)((()=>{try{c.value=new ha,console.log("CraftingService initialized successfully")}catch(e){console.error("Error initializing CraftingService:",e)}}));const l=(0,o.EW)((()=>s.currentLandscape)),d=(0,o.EW)((()=>a.characterId?n.characters.find((e=>e.id===a.characterId)):null)),u=(0,o.EW)((()=>s.currentChallenge?n.getChallengeById(s.currentChallenge):null)),h=e=>{r.value=e},m=()=>{r.value=null},p=(0,o.EW)((()=>!!l.value&&["Sacred Oak Grove","Druid's Sanctuary","Moonlit Loch"].includes(l.value.name))),g=((0,o.EW)((()=>{if(!a.resources.length)return[];const e=a.getCraftableItems();return e.map((e=>n.getCraftedItemById(e))).filter((e=>void 0!==e))})),(0,o.EW)((()=>{if(!l.value)return null;const e=l.value;return"Iron Forge Dell"===e.name||"Sacred Oak Grove"===e.name||"Druid's Sanctuary"===e.name||"Moonlit Loch"===e.name?1:null})),()=>{if(!u.value||!s.currentChallenge)return void s.addToGameLog("No active challenge to resolve.",!0);console.log("Resolving challenge:",u.value.name);const e=u.value.difficulty||5,t=s.threatLevel,o=0,r=e+t+o;let c=0;d.value?.specialAbility&&(c+=1);const h=a.animalCompanions.length>0?1:0;c+=h;const m=a.craftedItems.length>0?1:0;c+=m;const p=Math.floor(8*Math.random())+1,g=p+c;let f=!1,y=!1,v=0;if(8===p?(f=!0,s.addToGameLog("Natural 8! Automatic success regardless of modifiers.",!0)):(f=g>=r,y=!f&&g===r-1),f){if(i.value={success:!0,message:`You successfully resolved the challenge! Roll: ${p} + ${c} = ${g} vs difficulty ${r}`},s.addToGameLog(`Success! You rolled ${p} + ${c} = ${g} vs difficulty ${r}.`,!0),a.gainExperience(1),s.addToGameLog("You gained 1 experience point!",!0),l.value&&l.value.availableResources&&l.value.availableResources.length>0)for(let e=0;e<2&&!a.isResourceCapacityReached;e++){const e=Math.floor(Math.random()*l.value.availableResources.length),t=l.value.availableResources[e],o=a.addResource(t);if(o){const e=n.getResourceById(t);e&&s.addToGameLog(`You gathered ${e.name} as a reward.`,!0)}}s.setCurrentChallenge(null)}else if(y){if(i.value={success:!1,partialSuccess:!0,message:`You partially resolved the challenge. Roll: ${p} + ${c} = ${g} vs difficulty ${r}`},s.addToGameLog(`Partial success! You rolled ${p} + ${c} = ${g}, just one point below difficulty ${r}.`,!0),Math.random()<.5&&(a.gainExperience(1),s.addToGameLog("You gained 1 experience point for your effort!",!0)),l.value&&l.value.availableResources&&l.value.availableResources.length>0){const e=Math.floor(Math.random()*l.value.availableResources.length),t=l.value.availableResources[e],o=a.addResource(t);if(o){const e=n.getResourceById(t);e&&s.addToGameLog(`You gathered ${e.name} as a partial reward.`,!0)}}if(u.value){const e=u.value.type;let t="";switch(e){case L.STRENGTH:case L.AGILITY:v=1,a.loseHealth(v),t=`You suffer a minor injury. You lost ${v} health point.`;break;case L.WISDOM:s.addThreatTokens(1),t="Your confidence wavers. You gained 1 Threat token.";break;case L.DIPLOMACY:if(l.value&&l.value.availableResources&&l.value.availableResources.length>0){const e=Math.floor(Math.random()*l.value.availableResources.length),a=l.value.availableResources[e],o=n.getResourceById(a);o&&(s.addTempEffect(`resource_block_${a}`,"Resource Unavailable",`Cannot gather ${o.name}`,1,1),t=`The local community withholds ${o.name} from you for now.`)}break;case L.SURVIVAL:if(a.animalCompanions.length>0){a.animalCompanions[0];t="Your animal companion becomes wary of this place."}else s.addThreatTokens(1),t="The spiritual imbalance increases. You gained 1 Threat token.";break;default:v=1,a.loseHealth(v),t=`You encounter an unexpected setback. You lost ${v} health point.`}s.addToGameLog(`Setback: ${t}`,!0)}s.setCurrentChallenge(null)}else if(v=1,i.value={success:!1,message:`You failed to resolve the challenge. Roll: ${p} + ${c} = ${g} vs difficulty ${r}`,damage:v},s.addToGameLog(`Failure! You rolled ${p} + ${c} = ${g} vs difficulty ${r}.`,!0),a.loseHealth(v),s.addToGameLog(`You lost ${v} health point${v>1?"s":""}.`,!0),a.health<=0)return s.addToGameLog("Your journey has come to an end...",!0),void O();s.setPhase(S.CHALLENGE_RESOLUTION)}),A=()=>{a.loseHealth(1),s.addToGameLog("You chose to avoid the challenge, losing 1 health in the process.",!0),s.setPhase(S.RESOURCE_MANAGEMENT)},R=()=>{if(!u.value)return"?";const e=u.value.difficulty||5,t=s.threatLevel,a=0,n=e+t+a;return`${n} (Base: ${e} + Threat: ${t} + Season: ${a})`},k=()=>{if(!l.value||a.isResourceCapacityReached)return;let e=1;if(s.currentSeason===E.LUGHNASADH&&(e+=1,s.addToGameLog("The harvest season of Lughnasadh allows you to gather an extra resource.")),l.value.availableResources&&l.value.availableResources.length>0)for(let t=0;t<e&&!a.isResourceCapacityReached;t++){const e=Math.floor(Math.random()*l.value.availableResources.length),t=l.value.availableResources[e],o=a.addResource(t);if(o){const e=n.getResourceById(t);e&&s.addToGameLog(`You gathered ${e.name}.`,!0)}}else s.addToGameLog("There are no resources to gather at this location.",!0);s.advancePhase()},I=e=>{const t=n.getResourceById(e);return t?t.name:"Unknown Resource"},w=()=>{let e=1;s.currentSeason===E.IMBOLC&&(e+=1),s.currentSeason===E.LUGHNASADH&&(e*=2),p.value&&(e+=1),a.heal(e),s.addToGameLog(`You rest and recover ${e} health.`,!0),s.advancePhase()},N=()=>{if(s.currentPhase===S.ANIMAL_COMPANION){r.value&&m();const e=T(),t=e.landscapes.filter((e=>!s.visitedLandscapes.includes(e.id)));if(t.length>0){const e=Math.floor(Math.random()*t.length),a=t[e];s.setCurrentLandscape(a.id),s.addVisitedLandscape(a.id)}else s.addToGameLog("You have reached the end of your journey path.",!0),s.completeJourney(!0)}s.advancePhase()},O=()=>{console.log("Ending journey..."),a.resetPlayer(),s.resetGame(),t.push("/")},G=e=>{if(!e)return"Unknown";const t=e.toString();return t.charAt(0)+t.slice(1).toLowerCase()};return(e,t)=>((0,o.uX)(),(0,o.CE)("div",Ha,[t[21]||(t[21]=(0,o.Lk)("div",{style:{position:"absolute",top:"-20px",left:"0","background-color":"lightblue",padding:"2px 6px","font-size":"12px",color:"#333","z-index":"1070"}},"GameBoardView",-1)),(0,o.Lk)("div",Da,[(0,o.bF)(Pt)]),(0,o.Lk)("main",Pa,[(0,o.Lk)("section",$a,[(0,o.Lk)("div",Ba,[(0,o.bF)(je,{title:G((0,v.R1)(s).currentSeason),subtitle:"Current Season",cardType:(0,v.R1)(C).SEASON},{default:(0,o.k6)((()=>t[4]||(t[4]=[(0,o.Lk)("p",null,"The seasons affect which resources are available and the effectiveness of your animal companions.",-1)]))),_:1},8,["title","cardType"])])]),(0,o.Lk)("section",Fa,[(0,o.Lk)("div",xa,[(0,o.bF)(je,{title:d.value?d.value.name:"No Character Selected",subtitle:d.value?d.value.archetype:"",cardType:(0,v.R1)(C).CHARACTER},{default:(0,o.k6)((()=>[d.value?((0,o.uX)(),(0,o.CE)("div",Ya,[(0,o.Lk)("p",null,(0,y.v_)(d.value.description),1),d.value.specialAbility?((0,o.uX)(),(0,o.CE)("div",Wa,[t[5]||(t[5]=(0,o.Lk)("h4",null,"Special Ability:",-1)),(0,o.Lk)("p",null,(0,y.v_)(d.value.specialAbility.name)+": "+(0,y.v_)(d.value.specialAbility.description),1)])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)])),_:1},8,["title","subtitle","cardType"])])]),l.value?((0,o.uX)(),(0,o.CE)("section",Ua,[(0,o.Lk)("div",Xa,[(0,o.bF)(je,{title:l.value.name,subtitle:l.value.description,cardType:(0,v.R1)(C).LANDSCAPE},{default:(0,o.k6)((()=>[l.value.availableResources&&l.value.availableResources.length?((0,o.uX)(),(0,o.CE)("div",ja,[t[6]||(t[6]=(0,o.Lk)("h4",null,"Available Resources:",-1)),(0,o.Lk)("ul",null,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(l.value.availableResources,(e=>((0,o.uX)(),(0,o.CE)("li",{key:e},(0,y.v_)(I(e)),1)))),128))])])):(0,o.Q3)("",!0)])),_:1},8,["title","subtitle","cardType"])])])):(0,o.Q3)("",!0),(0,o.Lk)("section",qa,[(0,v.R1)(s).currentPhase===(0,v.R1)(S).EXPLORATION?((0,o.uX)(),(0,o.CE)("div",Va,[t[7]||(t[7]=(0,o.Lk)("h2",{class:"phase-title"},"EXPLORATION",-1)),(0,o.Lk)("div",za,[(0,o.Lk)("p",null,"You are exploring "+(0,y.v_)(l.value?.name)+". What will you discover?",1)]),(0,o.Lk)("button",{onClick:t[0]||(t[0]=e=>(0,v.R1)(s).advancePhase()),class:"btn btn--primary mt-4"}," Continue Exploration ")])):(0,v.R1)(s).currentPhase===(0,v.R1)(S).CHALLENGE&&u.value?((0,o.uX)(),(0,o.CE)("div",Ka,[t[10]||(t[10]=(0,o.Lk)("h2",{class:"phase-title"},"CHALLENGE",-1)),(0,o.Lk)("div",Ja,[(0,o.bF)(je,{title:u.value.name,subtitle:u.value.description,cardType:u.value.type},{default:(0,o.k6)((()=>[(0,o.Lk)("div",null,[(0,o.Lk)("p",null,[t[8]||(t[8]=(0,o.Lk)("strong",null,"Difficulty:",-1)),(0,o.eW)(" "+(0,y.v_)(u.value.difficulty),1)]),u.value.rewards?((0,o.uX)(),(0,o.CE)("div",Qa,[t[9]||(t[9]=(0,o.Lk)("h4",null,"Rewards:",-1)),(0,o.Lk)("ul",null,[u.value.rewards.resources?((0,o.uX)(),(0,o.CE)("li",Za,"Resources: "+(0,y.v_)(u.value.rewards.resources.join(", ")),1)):(0,o.Q3)("",!0),u.value.rewards.experience?((0,o.uX)(),(0,o.CE)("li",es,"Experience: "+(0,y.v_)(u.value.rewards.experience),1)):(0,o.Q3)("",!0),u.value.rewards.knowledge?((0,o.uX)(),(0,o.CE)("li",ts,"Knowledge: "+(0,y.v_)(u.value.rewards.knowledge),1)):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0)])])),_:1},8,["title","subtitle","cardType"])]),(0,o.Lk)("div",as,[(0,o.Lk)("p",null,"Difficulty: "+(0,y.v_)(R()),1)]),(0,o.Lk)("div",{class:"challenge-actions mt-4"},[(0,o.Lk)("button",{onClick:g,class:"btn btn--primary"}," Face Challenge "),(0,o.Lk)("button",{onClick:A,class:"btn btn--secondary ml-2"}," Avoid (Lose 1 Health) ")])])):(0,v.R1)(s).currentPhase===(0,v.R1)(S).CHALLENGE_RESOLUTION&&i.value?((0,o.uX)(),(0,o.CE)("div",ss,[t[11]||(t[11]=(0,o.Lk)("h2",{class:"phase-title"},"CHALLENGE OUTCOME",-1)),(0,o.Lk)("div",{class:(0,y.C4)(["challenge-result",{success:i.value.success,"partial-success":i.value.partialSuccess,failure:!i.value.success&&!i.value.partialSuccess}])},[(0,o.Lk)("h3",null,(0,y.v_)(i.value.success?"Success!":i.value.partialSuccess?"Partial Success":"Failure"),1),(0,o.Lk)("p",null,(0,y.v_)(i.value.message),1)],2),(0,o.Lk)("button",{onClick:t[1]||(t[1]=e=>(0,v.R1)(s).advancePhase()),class:"btn btn--primary mt-4"}," Continue ")])):(0,v.R1)(s).currentPhase===(0,v.R1)(S).RESOURCE_MANAGEMENT?((0,o.uX)(),(0,o.CE)("div",ns,[t[13]||(t[13]=(0,o.Lk)("h2",{class:"phase-title"},"RESOURCE MANAGEMENT",-1)),(0,o.Lk)("div",os,[(0,o.Lk)("button",{onClick:k,class:"btn btn--primary",disabled:(0,v.R1)(a).isResourceCapacityReached}," Gather Resources ",8,is),(0,o.Lk)("button",{onClick:w,class:"btn btn--secondary ml-2"}," Rest and Heal ")]),(0,v.R1)(a).isResourceCapacityReached?((0,o.uX)(),(0,o.CE)("div",rs,t[12]||(t[12]=[(0,o.Lk)("p",null,"You've reached your resource capacity!",-1)]))):(0,o.Q3)("",!0)])):(0,v.R1)(s).currentPhase===(0,v.R1)(S).CRAFTING?((0,o.uX)(),(0,o.CE)("div",cs,[t[14]||(t[14]=(0,o.Lk)("h2",{"data-testid":"craftingHeader","data-phase":"crafting",class:"phase-title"},"CRAFTING",-1)),(0,o.bF)(ga)])):(0,v.R1)(s).currentPhase===(0,v.R1)(S).ANIMAL_COMPANION?((0,o.uX)(),(0,o.CE)("div",ls,[t[15]||(t[15]=(0,o.Lk)("h2",{class:"phase-title"},"ANIMAL COMPANION",-1)),0===(0,v.R1)(a).animalCompanions.length?((0,o.uX)(),(0,o.CE)("div",ds,[(0,o.bF)(Tt,{onSelectCompanion:h}),(0,o.Lk)("div",{class:"action-buttons mt-4"},[(0,o.Lk)("button",{class:"btn btn--secondary",onClick:N}," Skip Animal Companion ")])])):((0,o.uX)(),(0,o.CE)("div",us,[(0,o.bF)(Qe),(0,o.Lk)("div",{class:"action-buttons mt-4"},[(0,o.Lk)("button",{class:"btn btn--primary",onClick:N}," Continue Journey ")])]))])):(0,v.R1)(s).currentPhase===(0,v.R1)(S).JOURNEY?((0,o.uX)(),(0,o.CE)("div",hs,[t[16]||(t[16]=(0,o.Lk)("h2",{class:"phase-title"},"JOURNEY",-1)),(0,o.bF)(Ma),(0,o.Lk)("div",ms,[(0,o.Lk)("button",{onClick:t[2]||(t[2]=e=>(0,v.R1)(s).advanceJourney(1)),class:"btn btn--primary"}," Journey Onwards ")])])):(0,v.R1)(s).currentPhase===(0,v.R1)(S).SEASONAL_ASSESSMENT?((0,o.uX)(),(0,o.CE)("div",ps,[t[20]||(t[20]=(0,o.Lk)("h2",{class:"phase-title"},"SEASONAL ASSESSMENT",-1)),(0,o.Lk)("div",gs,[(0,o.Lk)("p",null,[t[17]||(t[17]=(0,o.eW)("The current season is ")),(0,o.Lk)("strong",null,(0,y.v_)(G((0,v.R1)(s).currentSeason)),1),t[18]||(t[18]=(0,o.eW)("."))]),t[19]||(t[19]=(0,o.Lk)("p",null,"Assess how the season affects your journey and resources.",-1))]),(0,o.Lk)("div",fs,[(0,o.Lk)("button",{onClick:t[3]||(t[3]=e=>(0,v.R1)(s).advancePhase()),class:"btn btn--primary"}," Continue Journey ")])])):(0,o.Q3)("",!0)])]),(0,o.Lk)("aside",ys,[(0,o.bF)(ba)])]))}});const Cs=(0,l.A)(vs,[["__scopeId","data-v-74e972c2"]]);var Ls=Cs;const Es=[{path:"/",name:"setup",component:B},{path:"/game",name:"game",component:Ls}],Ts=(0,f.aE)({history:(0,f.LA)(),routes:Es});var Ss=Ts;const bs=(0,s.Ef)(g);bs.use((0,n.Ey)()),bs.use(Ss),bs.mount("#app")}},t={};function a(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,n,o){if(!s){var i=1/0;for(d=0;d<e.length;d++){s=e[d][0],n=e[d][1],o=e[d][2];for(var r=!0,c=0;c<s.length;c++)(!1&o||i>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[c])}))?s.splice(c--,1):(r=!1,o<i&&(i=o));if(r){e.splice(d--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[s,n,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var n,o,i=s[0],r=s[1],c=s[2],l=0;if(i.some((function(t){return 0!==e[t]}))){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(c)var d=c(a)}for(t&&t(s);l<i.length;l++)o=i[l],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},s=self["webpackChunkpathfinders_journey"]=self["webpackChunkpathfinders_journey"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(4565)}));s=a.O(s)})();
//# sourceMappingURL=app.b82b7439.js.map